b2400a4b592e3094b6c84e6000d512f99ae0eed8
roundcube@@roundcubemail
diff --git a/CHANGELOG b/CHANGELOG
index 410fb51973..a9597b9cb3 100644
--- a/CHANGELOG
+++ b/CHANGELOG
@@ -1,6 +1,8 @@
 CHANGELOG Roundcube Webmail
 ===========================
 
+- Security: Fix cross-site scripting (XSS) via HTML messages with malicious CSS content
+
 RELEASE 1.4.12
 --------------
 - Enigma: Fix bug where signature verification could fail for non-ascii bodies (#7919)
diff --git a/program/lib/Roundcube/rcube_washtml.php b/program/lib/Roundcube/rcube_washtml.php
index 60fdf9c2fd..7725ded0cf 100644
--- a/program/lib/Roundcube/rcube_washtml.php
+++ b/program/lib/Roundcube/rcube_washtml.php
@@ -338,7 +338,7 @@ private function wash_attribs($node)
                             if ($url = $this->wash_uri($match[2])) {
                                 $result .= ' ' . $attr->nodeName . '="' . $match[1]
                                     . '(' . htmlspecialchars($url, ENT_QUOTES, $this->config['charset']) . ')'
-                                    . substr($val, strlen($match[0])) . '"';
+                                    . htmlspecialchars(substr($val, strlen($match[0])), ENT_QUOTES, $this->config['charset']) . '"';
                                 continue;
                             }
                         }
diff --git a/tests/Framework/Washtml.php b/tests/Framework/Washtml.php
index 5d62890b3b..ec4f4a39b7 100644
--- a/tests/Framework/Washtml.php
+++ b/tests/Framework/Washtml.php
@@ -447,6 +447,10 @@ function data_wash_xss_tests()
                 '',
                 ''
             ],
+            [
+                ''
+            ],
             [
                 'clickme',
                 'clickme',
