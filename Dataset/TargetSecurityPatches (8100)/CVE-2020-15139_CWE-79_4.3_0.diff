37ad29dcd25489a37bdd89ebac761f22492558b0
mybb@@mybb
diff --git a/jscripts/bbcodes_sceditor.js b/jscripts/bbcodes_sceditor.js
index 07a7e8ab99..b77871443a 100644
--- a/jscripts/bbcodes_sceditor.js
+++ b/jscripts/bbcodes_sceditor.js
@@ -58,7 +58,7 @@ $(function ($) {
 	$.sceditor.formats.bbcode
 		.set('align', {
 			html: function (element, attrs, content) {
-				return '' + content + '';
+				return '' + content + '';
 			},
 			isInline: false
 		});
@@ -168,7 +168,7 @@ $(function ($) {
 			if (size < 0) {
 				size = 0;
 			}
-			return '' + content + '';
+			return '' + content + '';
 		}
 	});
 
@@ -218,7 +218,6 @@ $(function ($) {
 			var author = '',
 				$elm = $(element),
 				$cite = $elm.children('cite').first();
-			$cite.html($cite.text());
 
 			if ($cite.length === 1 || $elm.data('author')) {
 				author = $cite.text() || $elm.data('author');
@@ -244,13 +243,13 @@ $(function ($) {
 			var data = '';
 
 			if (attrs.pid)
-				data += ' data-pid="' + attrs.pid + '"';
+				data += ' data-pid="' + $.sceditor.escapeEntities(attrs.pid) + '"';
 
 			if (attrs.dateline)
-				data += ' data-dateline="' + attrs.dateline + '"';
+				data += ' data-dateline="' + $.sceditor.escapeEntities(attrs.dateline) + '"';
 
 			if (typeof attrs.defaultattr !== "undefined")
-				content = '' + attrs.defaultattr.replace(/ /g, ' ') + '' + content;
+				content = '' + $.sceditor.escapeEntities(attrs.defaultattr).replace(/ /g, ' ') + '' + content;
 
 			return '' + content + '';
 		},
@@ -280,7 +279,7 @@ $(function ($) {
 		html: function (token, attrs, content) {
 			if (typeof attrs.defaultattr == 'string' && attrs.defaultattr != '' && attrs.defaultattr != '{defaultattr}') {
 				return '' + content + '';
 			} else {
 				return content;
