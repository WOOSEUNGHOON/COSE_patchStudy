9931ed799650f5b8d5e1dc58ea3415a4cdc5773d
Icinga@@icingaweb2
diff --git a/library/Icinga/Web/Controller/StaticController.php b/library/Icinga/Web/Controller/StaticController.php
index 7c06dfedbc..2d65baf6df 100644
--- a/library/Icinga/Web/Controller/StaticController.php
+++ b/library/Icinga/Web/Controller/StaticController.php
@@ -39,10 +39,21 @@ public function handle(Request $request)
         }
 
         $assetRoot = $library->getStaticAssetPath();
+        if (empty($assetRoot)) {
+            $app->getResponse()
+                ->setHttpResponseCode(404);
+
+            return;
+        }
+
         $filePath = $assetRoot . DIRECTORY_SEPARATOR . $assetPath;
+        $dirPath = realpath(dirname($filePath)); // dirname, because the file may be a link
 
-        // Doesn't use realpath as it isn't supposed to access files outside asset/static
-        if (! is_readable($filePath) || ! is_file($filePath)) {
+        if (
+            $dirPath === false
+            || substr($dirPath, 0, strlen($assetRoot)) !== $assetRoot
+            || ! is_file($filePath)
+        ) {
             $app->getResponse()
                 ->setHttpResponseCode(404);
 
