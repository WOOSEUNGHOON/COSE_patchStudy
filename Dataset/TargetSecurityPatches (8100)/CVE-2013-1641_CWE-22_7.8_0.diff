7ac119cebd3b6bfe16a30fd1d5290127310a4436
realtimeprojects@@quixplorer
diff --git a/src/_include/fun_down.php b/src/_include/fun_down.php
index 813eddd..443151d 100644
--- a/src/_include/fun_down.php
+++ b/src/_include/fun_down.php
@@ -1,43 +1,7 @@
 
diff --git a/src/_include/fun_extra.php b/src/_include/fun_extra.php
index 21deeea..15c6015 100755
--- a/src/_include/fun_extra.php
+++ b/src/_include/fun_extra.php
@@ -1,6 +1,8 @@
 ERROR: Your PHP version is too old".
 	"You need at least PHP 4.0.0 to run QuiXplorer; preferably PHP 4.3.1 or higher.");
 }
-//------------------------------------------------------------------------------
-// Get Action
-if(isset($GLOBALS['__GET']["action"])) $GLOBALS["action"]=$GLOBALS['__GET']["action"];
-else $GLOBALS["action"]="list";
+
+_debug("xxx3 action: " . $GLOBALS['__GET']["action"] . "/" . $GLOBALS["__GET"]["do_action"] . "/" . (isset($GLOBALS['__GET']['action']) ? "true" : "false"));
+if (isset($GLOBALS['__GET']["action"]))
+{
+    $GLOBALS["action"]=$GLOBALS['__GET']["action"];
+}
+else
+{
+    $GLOBALS["action"]="list";
+}
 if($GLOBALS["action"]=="post" && isset($GLOBALS['__POST']["do_action"])) {
 	$GLOBALS["action"]=$GLOBALS['__POST']["do_action"];
 }
 if($GLOBALS["action"]=="") $GLOBALS["action"]="list";
 $GLOBALS["action"]=stripslashes($GLOBALS["action"]);
+_debug("xxx3 action: " . $GLOBALS['__GET']["action"] . "/" . $GLOBALS["__GET"]["do_action"] . "/" . (isset($GLOBALS['__GET']['action']) ? "true" : "false"));
+
 
 // Get Item
 if(isset($GLOBALS['__GET']["item"])) $GLOBALS["item"]=stripslashes($GLOBALS['__GET']["item"]);
diff --git a/src/_include/permissions.php b/src/_include/permissions.php
index 69be517..17035c2 100644
--- a/src/_include/permissions.php
+++ b/src/_include/permissions.php
@@ -29,10 +29,10 @@ function permissions_get ()
   depending the rights of the current user.
 
   @param $dir	Directory in which  the action should happen. If this parameter is
-  		NULL the engine relys on the global permissions of the user.
+  		NULL the engine checks the global permissions of the user.
   		
   @param $file	File on which the action should happen, if this parameter is NULL
-  		the permission engine relys on the permission of the directory.
+  		the permission engine checks the user permissions on the directory.
 
   @param $action
   		One ore more action of the action set (see permissions_get) which sould
diff --git a/src/_include/qxpath.php b/src/_include/qxpath.php
index 3df07b0..cc8e925 100644
--- a/src/_include/qxpath.php
+++ b/src/_include/qxpath.php
@@ -14,7 +14,7 @@
   user, since he should only see relative pathes.
  
  */
-function path_f ($path)
+function path_f ($path = '')
 {
     global $home_dir;
     $abs_dir = $home_dir;
diff --git a/src/_include/str.php b/src/_include/str.php
new file mode 100644
index 0000000..8a6a7fb
--- /dev/null
+++ b/src/_include/str.php
@@ -0,0 +1,8 @@
+
diff --git a/src/index.php b/src/index.php
index 6508f9a..b021d50 100755
--- a/src/index.php
+++ b/src/index.php
@@ -73,7 +73,11 @@
 	ob_start(); // prevent unwanted output
 	require "./_include/fun_down.php";
 	ob_end_clean(); // get rid of cached unwanted output
-	download_item($current_dir, $GLOBALS["item"]);
+    global $item;
+    _debug("download item: $current_dir/$item");
+    if ($item == '' )
+        show_error($GLOBALS["error_msg"]["miscselitems"]);
+	download_item($current_dir, $item);
 	ob_start(false); // prevent unwanted output
 	exit;
 break;
