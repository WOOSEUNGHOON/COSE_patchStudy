cb648f0d5690b81647dd5c9efe942ebf6cce7da9
thorsten@@phpMyFAQ
diff --git a/phpmyfaq/admin/ajax.tags.php b/phpmyfaq/admin/ajax.tags.php
index 4787e93aed..68bfbcfd5e 100644
--- a/phpmyfaq/admin/ajax.tags.php
+++ b/phpmyfaq/admin/ajax.tags.php
@@ -70,6 +70,12 @@
 
         $id = PMF_Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);
         $tag = PMF_Filter::filterInput(INPUT_POST, 'tag', FILTER_SANITIZE_STRING);
+        $csrfToken = PMF_Filter::filterInput(INPUT_POST, 'csrf', FILTER_SANITIZE_STRING);
+
+        if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {
+            echo json_encode($PMF_LANG['err_NotAuth']);
+            exit(1);
+        }
 
         $entity = new PMF_Entity_Tags();
         $entity->setId($id);
diff --git a/phpmyfaq/admin/assets/js/tags.js b/phpmyfaq/admin/assets/js/tags.js
index 723332f0d4..a6ae506905 100644
--- a/phpmyfaq/admin/assets/js/tags.js
+++ b/phpmyfaq/admin/assets/js/tags.js
@@ -29,7 +29,7 @@ $(document).ready(function () {
             );
         } else {
             var input = $('input[data-tag-id="' + id + '"]');
-            input.replaceWith('' + input.val() + '');
+            input.replaceWith('' + input.val().replace(/\//g, '/') + '');
         }
     });
 
@@ -40,11 +40,12 @@ $(document).ready(function () {
         var input = $('input[data-tag-id]:focus');
         var id = input.data('tag-id');
         var tag = input.val();
+        var csrf = $('input[name=csrf]').val();
 
         $.ajax({
             url: 'index.php?action=ajax&ajax=tags&ajaxaction=update',
             type: 'POST',
-            data: 'id=' + id + '&tag=' + tag,
+            data: 'id=' + id + '&tag=' + tag + '&csrf=' + csrf,
             dataType: 'json',
             beforeSend: function () {
                 $('#saving_data_indicator').html(
@@ -52,9 +53,9 @@ $(document).ready(function () {
                 );
             },
             success: function (message) {
-                input.replaceWith('' + input.val() + '');
-                $('span[data-tag-id="' + id + '"]').append(' ✓');
-                $('#saving_data_indicator').html('✓ ' + message);
+                input.replaceWith('' + input.val().replace(/\//g, '/') + '');
+                $('span[data-tag-id="' + id + '"]');
+                $('#saving_data_indicator').html(message);
             }
         });
 
diff --git a/phpmyfaq/admin/tags.main.php b/phpmyfaq/admin/tags.main.php
index 07d2400828..a094ddc87a 100644
--- a/phpmyfaq/admin/tags.main.php
+++ b/phpmyfaq/admin/tags.main.php
@@ -38,7 +38,7 @@
     


-
+                
perm->checkRight($user->getUserId(), 'editbt')) {
     $tags = new PMF_Tags($faqConfig);
@@ -63,7 +63,7 @@
 
     foreach ($tagData as $key => $tag) {
         echo '';
-        echo ''.$tag.'';
+        echo ''.PMF_String::htmlspecialchars($tag).'';
         printf(
             '',
             $key,
