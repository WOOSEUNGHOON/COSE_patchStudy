be9df82919960214ee4b9d3313523bff44fd99e1
ivmai@@bdwgc
diff --git a/malloc.c b/malloc.c
index 899d6ff12..cb49a5cf4 100644
--- a/malloc.c
+++ b/malloc.c
@@ -374,12 +374,16 @@ void * malloc(size_t lb)
   }
 #endif /* GC_LINUX_THREADS */
 
-#ifndef SIZE_MAX
-#define SIZE_MAX (~(size_t)0)
+#include 
+#ifdef SIZE_MAX
+# define GC_SIZE_MAX SIZE_MAX
+#else
+# define GC_SIZE_MAX (~(size_t)0)
 #endif
+
 void * calloc(size_t n, size_t lb)
 {
-    if (lb && n > SIZE_MAX / lb)
+    if (lb && n > GC_SIZE_MAX / lb)
       return NULL;
 #   if defined(GC_LINUX_THREADS) /* && !defined(USE_PROC_FOR_LIBRARIES) */
         /* libpthread allocated some memory that is only pointed to by  */
