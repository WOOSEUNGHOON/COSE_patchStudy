519341a7dece59e2c589b908a636e6cf12a61741
faiyazalam@@WordPress-plugin-user-login-history
diff --git a/admin/class-user-login-history-user-tracker.php b/admin/class-user-login-history-user-tracker.php
index d460f34..f6300a3 100644
--- a/admin/class-user-login-history-user-tracker.php
+++ b/admin/class-user-login-history-user-tracker.php
@@ -181,7 +181,8 @@ private function get_operating_system() {
             '/ipad/i' => 'iPad',
             '/android/i' => 'Android',
             '/blackberry/i' => 'BlackBerry',
-            '/webos/i' => 'Mobile'
+            '/webos/i' => 'Mobile',
+            '/cros/i' => 'Chrome'
         );
 
         foreach ($os_array as $regex => $value) {
@@ -337,10 +338,10 @@ public function save_user_login($user_login, $user) {
         $operating_system = $this->get_operating_system();
 
         $geo_location = $this->get_geo_location();
-        $country_name = $geo_location->geoplugin_countryName ? $geo_location->geoplugin_countryName : $unknown;
-        $country_code = $geo_location->geoplugin_countryCode ? $geo_location->geoplugin_countryCode : $unknown;
-        $lat = $geo_location->geoplugin_latitude ? $geo_location->geoplugin_latitude : 0;
-        $long = $geo_location->geoplugin_longitude ? $geo_location->geoplugin_longitude : 0;
+        $country_name = isset($geo_location->geoplugin_countryName) ? $geo_location->geoplugin_countryName : $unknown;
+        $country_code = isset($geo_location->geoplugin_countryCode) ? $geo_location->geoplugin_countryCode : $unknown;
+        $lat = isset($geo_location->geoplugin_latitude) ? $geo_location->geoplugin_latitude : 0;
+        $long = isset($geo_location->geoplugin_longitude )? $geo_location->geoplugin_longitude : 0;
 
         if ($lat != 0 && $long != 0 && $country_code != $unknown) {
             $user_timezone = $this->get_nearest_timezone($lat, $long, $country_code);
@@ -369,9 +370,8 @@ public function save_user_login($user_login, $user) {
 
         $wpdb->insert($table, $data);
         if ("" != $wpdb->last_error) {
-            ini_set('error_log', WP_CONTENT_DIR . '/debug-user-login-history.log');
-            error_log("last error:" . $wpdb->last_error);
-            error_log("last query:" . $wpdb->last_query);
+           User_Login_History_Error_Handler::error_log("last error:" . $wpdb->last_error. " last query:" . $wpdb->last_query);
+            return;
         }
 
         //save user time zone in user_meta table
@@ -400,13 +400,10 @@ public function save_user_logout() {
         $wpdb->query($sql);
         
          if ("" != $wpdb->last_error) {
-            ini_set('error_log', WP_CONTENT_DIR . '/debug-user-login-history.log');
-            error_log("last error:" . $wpdb->last_error);
-            error_log("last query:" . $wpdb->last_query);
+          User_Login_History_Error_Handler::error_log("last error:" . $wpdb->last_error. " last query:" . $wpdb->last_query);
         }
         
-        //unset session for this plugin after user gets logged out.
-        unset($_SESSION[$this->name]);
+        session_destroy();
     }
 
     /**
@@ -453,9 +450,7 @@ public function update_time_last_seen() {
         $sql = " update $table set time_last_seen='$current_date' where id=$last_id ";
         $wpdb->query($sql);
            if ("" != $wpdb->last_error) {
-            ini_set('error_log', WP_CONTENT_DIR . '/debug-user-login-history.log');
-            error_log("last error:" . $wpdb->last_error);
-            error_log("last query:" . $wpdb->last_query);
+          User_Login_History_Error_Handler::error_log("last error:" . $wpdb->last_error. " last query:" . $wpdb->last_query);
         }
     }
 
diff --git a/admin/partials/listing/listing.php b/admin/partials/listing/listing.php
index 0ec8ab6..d4d118e 100644
--- a/admin/partials/listing/listing.php
+++ b/admin/partials/listing/listing.php
@@ -32,8 +32,8 @@
                 


-                            " id="date_from" name="date_from" value="" class="textfield-bg">
-                            " name="date_to" id="date_to" value="" class="textfield-bg">
+                            " id="date_from" name="date_from" value="" class="textfield-bg">
+                            " name="date_to" id="date_to" value="" class="textfield-bg">





-                            " name="user_id" value="" class="textfield-bg">
-                            " name="username" value="" class="textfield-bg">
-                            " name="country_name" value="" class="textfield-bg">
-                            " name="browser" value="" class="textfield-bg">
-                            " name="operating_system" value="" class="textfield-bg">
-                            " name="ip_address" value="" class="textfield-bg">
+                            " name="user_id" value="" class="textfield-bg">
+                            " name="username" value="" class="textfield-bg">
+                            " name="country_name" value="" class="textfield-bg">
+                            " name="browser" value="" class="textfield-bg">
+                            " name="operating_system" value="" class="textfield-bg">
+                            " name="ip_address" value="" class="textfield-bg">



diff --git a/includes/class-user-login-history-error-handler.php b/includes/class-user-login-history-error-handler.php
new file mode 100644
index 0000000..bb530cd
--- /dev/null
+++ b/includes/class-user-login-history-error-handler.php
@@ -0,0 +1,22 @@
+ID) {
     _e('Error- Unable to find user id. Please login.', 'user-login-history');
     return;
@@ -54,12 +55,12 @@
 $logins = $paginations['rows'];
 $timezones = User_Login_History_Date_Time_Helper :: get_timezone_list();
 ?>
-
+



-                " class="textfield-bg">
-                " class="textfield-bg">
+                " class="textfield-bg">
+                " class="textfield-bg">





-                    
+                    
+                
+                
+                   request ), 2)[0])."> ".__('RESET', 'user-login-history')."";?>
                 


diff --git a/user-login-history.php b/user-login-history.php
index 18f6a44..e66bd7a 100644
--- a/user-login-history.php
+++ b/user-login-history.php
@@ -26,7 +26,9 @@
 if (!defined('WPINC')) {
     die;
 }
+
 require_once plugin_dir_path(__FILE__) . 'includes/user-login-history-config.php';
+require_once plugin_dir_path(__FILE__) . 'includes/class-user-login-history-error-handler.php';
 
 /**
  * The code that runs during plugin activation.
