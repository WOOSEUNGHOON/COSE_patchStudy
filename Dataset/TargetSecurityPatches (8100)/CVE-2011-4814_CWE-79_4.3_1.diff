762f98ab4137749d0993612b4e3544a4207e78a1
Dolibarr@@dolibarr
diff --git a/htdocs/admin/boxes.php b/htdocs/admin/boxes.php
index 34e7f48cea8..9354864a174 100644
--- a/htdocs/admin/boxes.php
+++ b/htdocs/admin/boxes.php
@@ -29,8 +29,9 @@
 
 $langs->load("admin");
 
-if (!$user->admin)
-  accessforbidden();
+$id=GETPOST('rowid','int');
+
+if (!$user->admin) accessforbidden();
 
 // Definition des positions possibles pour les boites
 $pos_array = array(0);                             // Positions possibles pour une boite (0,1,2,...)
@@ -101,7 +102,7 @@
 	$db->begin();
 
 	$sql = "DELETE FROM ".MAIN_DB_PREFIX."boxes";
-	$sql.= " WHERE rowid=".$_GET["rowid"];
+	$sql.= " WHERE rowid=".$id;
 	$resql = $db->query($sql);
 
 	// Remove all personalized setup when a box is activated or disabled
@@ -288,7 +289,7 @@
 
 		dol_include_once($sourcefile);
 		$box=new $boxname($db,$obj->note);
-		
+
 		$enabled=true;
 		if ($box->depends && sizeof($box->depends) > 0)
 		{
@@ -297,7 +298,7 @@
 				if (empty($conf->$module->enabled)) $enabled=false;
 			}
 		}
-		
+
 		if ($enabled)
 		{
 			//if (in_array($obj->rowid, $actives) && $box->box_multiple <> 1)
@@ -308,7 +309,7 @@
 			else
 			{
 				$var=!$var;
-	
+
 				if (preg_match('/^([^@]+)@([^@]+)$/i',$box->boximg))
 				{
 					$logo = $box->boximg;
@@ -317,14 +318,14 @@
 				{
 					$logo=preg_replace("/^object_/i","",$box->boximg);
 				}
-	
+
 				print '';
 				print '';
 				print '';
 				print ''.img_object("",$logo).' '.$box->boxlabel.'';
 				print '' . ($obj->note?$obj->note:'Â ') . '';
 				print '' . $sourcefile . '';
-	
+
 				// Pour chaque position possible, on affiche un lien
 				// d'activation si boite non deja active pour cette position
 				print '';
@@ -333,11 +334,11 @@
 				print '';
 				print ' ';
 				print '';
-	
+
 				print '';
 			}
 		}
-		
+
 		$i++;
 	}
 
diff --git a/htdocs/admin/ihm.php b/htdocs/admin/ihm.php
index b3f50ac43c7..4bb68c5ac0b 100644
--- a/htdocs/admin/ihm.php
+++ b/htdocs/admin/ihm.php
@@ -38,8 +38,7 @@
 $langs->load("products");
 $langs->load("members");
 
-if (!$user->admin)
-  accessforbidden();
+if (!$user->admin) accessforbidden();
 
 
 if (! defined("MAIN_MOTD")) define("MAIN_MOTD","");
diff --git a/htdocs/lib/usergroups.lib.php b/htdocs/lib/usergroups.lib.php
index d9c4b5a542f..860ff6656d6 100644
--- a/htdocs/lib/usergroups.lib.php
+++ b/htdocs/lib/usergroups.lib.php
@@ -234,7 +234,7 @@ function show_theme($fuser,$edit=0,$foruserprofile=false)
             $url=$urltheme."/".$subdir."/thumb.png";
             if (! file_exists($file)) $url=$urltheme."/common/nophoto.jpg";
             print '';
-			print '';
+			print 'id:'').'" style="font-weight: normal;" alt="'.$langs->trans("Preview").'">';
 			if ($subdir == $conf->global->MAIN_THEME) $title=$langs->trans("ThemeCurrentlyActive");
 			else $title=$langs->trans("ShowPreview");
             print '';
diff --git a/htdocs/main.inc.php b/htdocs/main.inc.php
index 689b9a48bce..e6796b41870 100644
--- a/htdocs/main.inc.php
+++ b/htdocs/main.inc.php
@@ -76,6 +76,7 @@ function test_sql_and_script_inject($val,$get)
 	$sql_inj += preg_match('/(\.\.%2f)+/i', $val);
 	// For XSS Injection done by adding javascript with script
 	$sql_inj += preg_match('/