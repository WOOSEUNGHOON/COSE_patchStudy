ff06c7c885dc94ed7c828e8cdbb8b5d850a7e654
openstack@@nova
diff --git a/nova/api/ec2/cloud.py b/nova/api/ec2/cloud.py
index 43686aa12a1..723c7fca748 100644
--- a/nova/api/ec2/cloud.py
+++ b/nova/api/ec2/cloud.py
@@ -598,7 +598,7 @@ def _rule_dict_last_step(self, context, to_port=None, from_port=None,
                       to_port=to_port, msg="For ICMP, the"
                                            " type:code must be valid")
 
-            values['protocol'] = ip_protocol
+            values['protocol'] = ip_protocol.lower()
             values['from_port'] = from_port
             values['to_port'] = to_port
         else:
diff --git a/nova/api/openstack/compute/contrib/security_groups.py b/nova/api/openstack/compute/contrib/security_groups.py
index 7e3f9375216..4a69d392ea1 100644
--- a/nova/api/openstack/compute/contrib/security_groups.py
+++ b/nova/api/openstack/compute/contrib/security_groups.py
@@ -524,7 +524,7 @@ def _rule_args_to_dict(self, context, to_port=None, from_port=None,
                       to_port=to_port, msg="For ICMP, the"
                                            " type:code must be valid")
 
-            values['protocol'] = ip_protocol
+            values['protocol'] = ip_protocol.lower()
             values['from_port'] = from_port
             values['to_port'] = to_port
         else:
diff --git a/nova/virt/firewall.py b/nova/virt/firewall.py
index bca50d21f37..be6a0f7c972 100644
--- a/nova/virt/firewall.py
+++ b/nova/virt/firewall.py
@@ -331,8 +331,8 @@ def instance_rules(self, instance, network_info):
                 else:
                     fw_rules = ipv6_rules
 
-                protocol = rule.protocol
-                if version == 6 and rule.protocol == 'icmp':
+                protocol = rule.protocol.lower()
+                if version == 6 and protocol == 'icmp':
                     protocol = 'icmpv6'
 
                 args = ['-j ACCEPT']
