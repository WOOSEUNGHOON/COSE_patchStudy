1ed07e257a2c0794ba19e864f7c5101e7e8c41d2
joomla@@joomla-cms
diff --git a/administrator/components/com_media/helpers/media.php b/administrator/components/com_media/helpers/media.php
index 88071b941a04..e43d818ed378 100644
--- a/administrator/components/com_media/helpers/media.php
+++ b/administrator/components/com_media/helpers/media.php
@@ -60,7 +60,7 @@ public static function canUpload($file, &$err)
 
 		$allowable = explode(',', $params->get('upload_extensions'));
 		$ignored = explode(',', $params->get('ignore_extensions'));
-		if (!in_array($format, $allowable) && !in_array($format, $ignored))
+		if ($format == '' || $format == false || (!in_array($format, $allowable) && !in_array($format, $ignored)))
 		{
 			$err = 'COM_MEDIA_ERROR_WARNFILETYPE';
 			return false;
diff --git a/administrator/includes/framework.php b/administrator/includes/framework.php
index 12ab87b2defe..2e05d59b4e99 100644
--- a/administrator/includes/framework.php
+++ b/administrator/includes/framework.php
@@ -19,7 +19,7 @@
 /*
  * Installation check, and check on removal of the install directory.
  */
-if (!file_exists(JPATH_CONFIGURATION.'/configuration.php') || (filesize(JPATH_CONFIGURATION.'/configuration.php') < 10) /*|| file_exists(JPATH_INSTALLATION.'/index.php')*/) {
+if (!file_exists(JPATH_CONFIGURATION.'/configuration.php') || (filesize(JPATH_CONFIGURATION.'/configuration.php') < 10) || file_exists(JPATH_INSTALLATION.'/index.php')) {
 	header('Location: ../installation/index.php');
 	exit();
 }
diff --git a/administrator/manifests/files/joomla.xml b/administrator/manifests/files/joomla.xml
index 9d250bef6598..0292980f10ea 100644
--- a/administrator/manifests/files/joomla.xml
+++ b/administrator/manifests/files/joomla.xml
@@ -5,9 +5,9 @@
 	admin@joomla.org
www.joomla.org
(C) 2005 - 2013 Open Source Matters. All rights reserved
-	GNU General Public License version 2 or later; see     LICENSE.txt
+	GNU General Public License version 2 or later; see LICENSE.txt
2.5.14
-	July 2013
+	August 2013
FILES_JOOMLA_XML_DESCRIPTION
administrator/components/com_admin/script.php
diff --git a/build/build.php b/build/build.php
index 4787287f55c8..18602c8b6f28 100644
--- a/build/build.php
+++ b/build/build.php
@@ -32,7 +32,7 @@
 
 // Set release for each build
 // Release is third digit (like '0', '1', or '2')
-$release = '12';
+$release = '14';
 
 // Set path to git binary (e.g., /usr/local/git/bin/git or /urs/bin/git)
 $gitPath = '/usr/bin/git';
@@ -74,26 +74,26 @@
 // So we add the index file for each top-level directory.
 // Note: If we add new top-level directories or files, be sure to include them here.
 $filesArray = array(
-		"administrator/index.php\n" => true,

-		"cache/index.html\n" => true,

-		"cli/index.html\n" => true,

-		"components/index.html\n" => true,

-		"images/index.html\n" => true,

-		"includes/index.html\n" => true,

-		"language/index.html\n" => true,

-		"libraries/index.html\n" => true,

-		"logs/index.html\n" => true,

-		"media/index.html\n" => true,

-		"modules/index.html\n" => true,

-		"plugins/index.html\n" => true,

-		"templates/index.html\n" => true,

-		"tmp/index.html\n" => true,

-		"htaccess.txt\n" => true,

+		"administrator/index.php\n" => true,
+		"cache/index.html\n" => true,
+		"cli/index.html\n" => true,
+		"components/index.html\n" => true,
+		"images/index.html\n" => true,
+		"includes/index.html\n" => true,
+		"language/index.html\n" => true,
+		"libraries/index.html\n" => true,
+		"logs/index.html\n" => true,
+		"media/index.html\n" => true,
+		"modules/index.html\n" => true,
+		"plugins/index.html\n" => true,
+		"templates/index.html\n" => true,
+		"tmp/index.html\n" => true,
+		"htaccess.txt\n" => true,
 		"web.config.txt\n" => true,
 		"robots.txt.dist\n" => true,
-		"LICENSE.txt\n" => true,

-		"README.txt\n" => true,

-		"index.php\n" => true,

+		"LICENSE.txt\n" => true,
+		"README.txt\n" => true,
+		"index.php\n" => true,
 		"joomla.xml\n" => true,
 );
 
@@ -113,9 +113,9 @@
 	// Loop through and add all files except: tests, installation, build, .git, or docs
 	foreach($files AS $file)
 	{
-		if (substr($file, 2, 5) != 'tests' && substr($file, 2, 12) != 'installation' && substr($file,2,5) != 'build'
-		&& substr($file, 2, 4) != '.git' && substr($file, 2, 4) != 'docs' &&  substr($file, 2, 7) != '.travis'
-		&&  substr($file, 2, 6) != 'travis' &&  substr($file, 2, 7) != 'phpunit')
+		if (substr($file, 2, 5) != 'tests' && substr($file, 2, 12) != 'installation' && substr($file, 2, 5) != 'build'
+		&& substr($file, 2, 4) != '.git' && substr($file, 2, 4) != 'docs' && substr($file, 2, 7) != '.travis'
+		&& substr($file, 2, 6) != 'travis' && substr($file, 2, 7) != 'phpunit' && substr($file, -3) != '.md')
 		{
 			// Don't add deleted files to the list
 			if (substr($file, 0, 1) != 'D')
@@ -136,10 +136,10 @@
 	file_put_contents('diffconvert/'.$version.'.'.$num, implode("", $filePut));
 	file_put_contents('diffconvert/'.$version.'.'.$num.'-deleted', $deletedFiles);
 
-	// Only create archives for 0 and most recent versions. Skip other update versions.

-	if ($num != 0 && ($num != $release - 1)) {

-		echo "Skipping create archive for version $version.$num\n";

-		continue;

+	// Only create archives for 0 and most recent versions. Skip other update versions.
+	if ($num != 0 && ($num != $release - 1)) {
+		echo "Skipping create archive for version $version.$num\n";
+		continue;
 	}
 
 	$fromName = $num == 0 ? 'x' : $num;
diff --git a/includes/framework.php b/includes/framework.php
index 7a4893aeae47..3e6984e9e148 100644
--- a/includes/framework.php
+++ b/includes/framework.php
@@ -20,7 +20,7 @@
 // Installation check, and check on removal of the install directory.
 //
 
-if (!file_exists(JPATH_CONFIGURATION.'/configuration.php') || (filesize(JPATH_CONFIGURATION.'/configuration.php') < 10) /*|| file_exists(JPATH_INSTALLATION.'/index.php')*/) {
+if (!file_exists(JPATH_CONFIGURATION.'/configuration.php') || (filesize(JPATH_CONFIGURATION.'/configuration.php') < 10) || file_exists(JPATH_INSTALLATION.'/index.php')) {
 
 	if (file_exists(JPATH_INSTALLATION.'/index.php')) {
 		header('Location: '.substr($_SERVER['REQUEST_URI'], 0, strpos($_SERVER['REQUEST_URI'], 'index.php')).'installation/index.php');
diff --git a/installation/CHANGELOG b/installation/CHANGELOG
index 0ce07461906d..6711cb993f65 100644
--- a/installation/CHANGELOG
+++ b/installation/CHANGELOG
@@ -26,6 +26,8 @@ $ -> Language fix or change
 - -> Removed
 ! -> Note
 
+-------------------- 2.5.14 Stable Release 01-August-2013] ------------------
+
 31-Jul-2013 Jean-Marie Simonet
  # Missing list of Subcategories in a blog view. Revert [#30150]
 
diff --git a/installation/sql/mysql/joomla.sql b/installation/sql/mysql/joomla.sql
index a08067e58ca3..48986e9632fe 100644
--- a/installation/sql/mysql/joomla.sql
+++ b/installation/sql/mysql/joomla.sql
@@ -536,7 +536,7 @@ INSERT INTO `#__extensions` (`extension_id`, `name`, `type`, `element`, `folder`
 (601, 'English (United Kingdom)', 'language', 'en-GB', '', 1, 1, 1, 1, '', '', '', '', 0, '0000-00-00 00:00:00', 0, 0);
 
 INSERT INTO `#__extensions` (`extension_id`, `name`, `type`, `element`, `folder`, `client_id`, `enabled`, `access`, `protected`, `manifest_cache`, `params`, `custom_data`, `system_data`, `checked_out`, `checked_out_time`, `ordering`, `state`) VALUES
-(700, 'Joomla! CMS', 'file', 'joomla', '', 0, 1, 1, 1, '{"legacy":false,"name":"files_joomla","type":"file","creationDate":"July 2013","author":"Joomla!","copyright":"(C) 2005 - 2013 Open Source Matters. All rights reserved","authorEmail":"admin@joomla.org","authorUrl":"www.joomla.org","version":"2.5.13","description":"FILES_JOOMLA_XML_DESCRIPTION","group":""}', '', '', '', 0, '0000-00-00 00:00:00', 0, 0);
+(700, 'Joomla! CMS', 'file', 'joomla', '', 0, 1, 1, 1, '{"legacy":false,"name":"files_joomla","type":"file","creationDate":"August 2013","author":"Joomla!","copyright":"(C) 2005 - 2013 Open Source Matters. All rights reserved","authorEmail":"admin@joomla.org","authorUrl":"www.joomla.org","version":"2.5.14","description":"FILES_JOOMLA_XML_DESCRIPTION","group":""}', '', '', '', 0, '0000-00-00 00:00:00', 0, 0);
 
 INSERT INTO `#__extensions` (`extension_id`, `name`, `type`, `element`, `folder`, `client_id`, `enabled`, `access`, `protected`, `manifest_cache`, `params`, `custom_data`, `system_data`, `checked_out`, `checked_out_time`, `ordering`, `state`) VALUES
 (800, 'joomla', 'package', 'pkg_joomla', '', 0, 1, 1, 1, '', '', '', '', 0, '0000-00-00 00:00:00', 0, 0);
diff --git a/installation/sql/sqlazure/joomla.sql b/installation/sql/sqlazure/joomla.sql
index 4d6152da17d3..13ea035b4dec 100644
--- a/installation/sql/sqlazure/joomla.sql
+++ b/installation/sql/sqlazure/joomla.sql
@@ -2879,7 +2879,7 @@ SELECT 601, 'English (United Kingdom)', 'language', 'en-GB', '', 1, 1, 1, 1, '',
 
 
 INSERT INTO #__extensions (extension_id, name, type, element, folder, client_id, enabled, access, protected, manifest_cache, params, custom_data, system_data, checked_out, checked_out_time, ordering, state)
-VALUES (700, 'Joomla! CMS', 'file', 'joomla', '', 0, 1, 1, 1, '{"legacy":false,"name":"files_joomla","type":"file","creationDate":"July 2013","author":"Joomla!","copyright":"(C) 2005 - 2011 Open Source Matters. All rights reserved","authorEmail":"admin@joomla.org","authorUrl":"www.joomla.org","version":"2.5.13","description":"FILES_JOOMLA_XML_DESCRIPTION","group":""}', '', '', '', 0, '1900-01-01 00:00:00', 0, 0);
+VALUES (700, 'Joomla! CMS', 'file', 'joomla', '', 0, 1, 1, 1, '{"legacy":false,"name":"files_joomla","type":"file","creationDate":"August 2013","author":"Joomla!","copyright":"(C) 2005 - 2011 Open Source Matters. All rights reserved","authorEmail":"admin@joomla.org","authorUrl":"www.joomla.org","version":"2.5.14","description":"FILES_JOOMLA_XML_DESCRIPTION","group":""}', '', '', '', 0, '1900-01-01 00:00:00', 0, 0);
 
 INSERT INTO #__extensions (extension_id, name,type, element, folder, client_id, enabled, access, protected, manifest_cache, params, custom_data, system_data, checked_out, checked_out_time, ordering, state) VALUES
 (800, 'joomla', 'package', 'pkg_joomla', '', 0, 1, 1, 1, '', '', '', '', 0, '1900-01-01 00:00:00', 0, 0);
diff --git a/libraries/cms/version/version.php b/libraries/cms/version/version.php
index fcba202d77c9..0b551e3d421d 100644
--- a/libraries/cms/version/version.php
+++ b/libraries/cms/version/version.php
@@ -35,7 +35,7 @@ final class JVersion
 	public $CODENAME = 'Ember';
 
 	/** @var  string  Release date. */
-	public $RELDATE = '24-July-2013';
+	public $RELDATE = '01-August-2013';
 
 	/** @var  string  Release time. */
 	public $RELTIME = '14:00';
diff --git a/libraries/joomla/filesystem/file.php b/libraries/joomla/filesystem/file.php
index 3725776ad9eb..c44f066f2bdc 100644
--- a/libraries/joomla/filesystem/file.php
+++ b/libraries/joomla/filesystem/file.php
@@ -61,6 +61,9 @@ public static function stripExt($file)
 	 */
 	public static function makeSafe($file)
 	{
+		// Remove any trailing dots, as those aren't ever valid file names.
+		$file = rtrim($file, '.');
+
 		$regex = array('#(\.){2,}#', '#[^A-Za-z0-9\.\_\- ]#', '#^\.#');
 
 		return preg_replace($regex, '', $file);
