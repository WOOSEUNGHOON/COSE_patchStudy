2ce3ab6985c3a909eefb01c562995bc6a994d3a2
advancedforms@@advanced-forms
diff --git a/core/forms/forms-rendering.php b/core/forms/forms-rendering.php
index 2c8fc5f..e7eb16b 100644
--- a/core/forms/forms-rendering.php
+++ b/core/forms/forms-rendering.php
@@ -298,13 +298,20 @@ function render_fields( $form, $args ) {
     // Hidden fields to identify form
     echo '';
 
-      $nonce = wp_create_nonce( 'acf_nonce' );
-      echo sprintf( '', $nonce );
-      echo sprintf( '', $nonce );
+      $acf_nonce = wp_create_nonce( 'acf_nonce' );
+      echo sprintf( '', $acf_nonce );
+      echo sprintf( '', $acf_nonce );
     
       echo sprintf( '', $form['key'] );
-      echo sprintf( '', base64_encode( json_encode( $args ) ) );
-      echo sprintf( '', base64_encode( json_encode( $args ) ) );
+
+      $encoded_args = base64_encode( json_encode( $args ) );
+      echo sprintf( '', $encoded_args );
+      echo sprintf( '', $encoded_args );
+
+      // Add nonce to ensure arguments can't be altered.
+      $hashed_args = hash( 'sha256', $encoded_args );
+      $nonce = wp_create_nonce( sprintf( 'af_submission_%s_%s', $form['key'], $hashed_args ) );
+      echo sprintf( '', $nonce );
 
       // Add honeypot field that is not visible to users.
       // Bots should hopefully fill this in allowing them to be detected.
diff --git a/core/forms/forms-submissions.php b/core/forms/forms-submissions.php
index fb63a94..ce3cde6 100644
--- a/core/forms/forms-submissions.php
+++ b/core/forms/forms-submissions.php
@@ -173,7 +173,17 @@ function create_submission() {
     }
 
     // Retrieve the args used to display the form
-    $args = json_decode( base64_decode( $_POST['af_form_args'] ), true );
+    $encoded_args = $_POST['af_form_args'];
+    $args = json_decode( base64_decode( $encoded_args ), true );
+
+    // Verify nonce
+    $nonce = $_POST['af_form_nonce'];
+    $hashed_args = hash( 'sha256', $encoded_args );
+    $nonce_value = sprintf( 'af_submission_%s_%s', $form['key'], $hashed_args );
+    if ( ! wp_verify_nonce( $nonce, $nonce_value ) ) {
+      wp_die( 'Invalid form nonce' );
+      exit;
+    }
 
     // Retrieve all form fields and their values
     $fields = array();
