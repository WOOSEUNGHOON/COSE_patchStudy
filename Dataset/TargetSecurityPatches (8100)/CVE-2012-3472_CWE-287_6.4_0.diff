4c24325
ushahidi@@Ushahidi_Web
diff --git a/application/libraries/api/MY_Email_Api_Object.php b/application/libraries/api/MY_Email_Api_Object.php
index 3c2c1cd303..be5a510b77 100644
--- a/application/libraries/api/MY_Email_Api_Object.php
+++ b/application/libraries/api/MY_Email_Api_Object.php
@@ -1,6 +1,6 @@
 api_service->_login(TRUE))
+			{
+				$this->set_error_message($this->response(2));
+				return;
+			}
+			
         $this->_list_all_email_msgs();
     }
 
@@ -34,6 +41,13 @@ public function perform_task()
      */
     public function email_action()
     {
+			// Authenticate the user
+			if ( ! $this->api_service->_login(TRUE))
+			{
+				$this->set_error_message($this->response(2));
+				return;
+			}
+			
         if ( ! $this->api_service->verify_array_index($this->request, 'action'))
         {
             $this->set_error_message(array(
@@ -159,7 +173,7 @@ public function _delete_email_msg()
                     //email id doesn't exist in DB
                     //TODO i18nize the string
                     $this->error_messages .= "Email ID does not exist.";
-                    $this->ret_value = 1;
+                    $ret_value = 1;
 
                 }
             }
