796c3ae318eea183fc88c87ec5a27355b0f6a99d
archivy@@archivy
diff --git a/archivy/__init__.py b/archivy/__init__.py
index b3aa3e7c..a4eaeee9 100644
--- a/archivy/__init__.py
+++ b/archivy/__init__.py
@@ -6,6 +6,7 @@
 from flask import Flask
 from flask_compress import Compress
 from flask_login import LoginManager
+from flask_wtf.csrf import CSRFProtect
 
 from archivy import helpers
 from archivy.api import api_bp
@@ -77,6 +78,7 @@
 login_manager.login_view = "login"
 login_manager.init_app(app)
 app.register_blueprint(api_bp, url_prefix="/api")
+csrf = CSRFProtect(app)
 
 # compress files
 Compress(app)
diff --git a/archivy/click_web/resources/cmd_exec.py b/archivy/click_web/resources/cmd_exec.py
index 3e31f89c..c92e9d07 100644
--- a/archivy/click_web/resources/cmd_exec.py
+++ b/archivy/click_web/resources/cmd_exec.py
@@ -137,10 +137,8 @@ def _get_download_link(field_info):
 

 class RequestToCommandArgs:

     def __init__(self):

-        field_infos = [

-            FieldInfo.factory(key)

-            for key in list(request.form.keys()) + list(request.files.keys())

-        ]

+        keys = [key for key in list(request.form.keys()) + list(request.files.keys())]

+        field_infos = [FieldInfo.factory(key) for key in keys if key != "csrf_token"]

         # important to sort them so they will be in expected order on command line

         self.field_infos = list(sorted(field_infos))

 

diff --git a/archivy/routes.py b/archivy/routes.py
index 1c623a5b..dc7a368a 100644
--- a/archivy/routes.py
+++ b/archivy/routes.py
@@ -232,7 +232,7 @@ def move_item(dataobj_id):
         return redirect(f"/dataobj/{dataobj_id}")
 
 
-@app.route("/dataobj/delete/", methods=["DELETE", "GET"])
+@app.route("/dataobj/delete/", methods=["POST"])
 def delete_data(dataobj_id):
     try:
         data.delete_item(dataobj_id)
diff --git a/archivy/templates/click_web/command_form.html b/archivy/templates/click_web/command_form.html
index cdffd0cf..3c68052a 100644
--- a/archivy/templates/click_web/command_form.html
+++ b/archivy/templates/click_web/command_form.html
@@ -29,6 +29,7 @@ {{ command.name|title }}


         {% endfor %}

     {% endfor %}

+	
Run


 

diff --git a/archivy/templates/dataobjs/show.html b/archivy/templates/dataobjs/show.html
index aad86636..83781921 100644
--- a/archivy/templates/dataobjs/show.html
+++ b/archivy/templates/dataobjs/show.html
@@ -71,7 +71,7 @@ 

Edit

-          
+          
             {{ form.hidden_tag() }}
             

diff --git a/tests/functional/test_routes.py b/tests/functional/test_routes.py
index 836f38b4..7e59bf42 100644
--- a/tests/functional/test_routes.py
+++ b/tests/functional/test_routes.py
@@ -61,12 +61,12 @@ def test_get_dataobj(test_app, client: FlaskClient, note_fixture):
 
 
 def test_get_delete_dataobj_not_found(test_app, client: FlaskClient):
-    response = client.get("/dataobj/delete/1")
+    response = client.post("/dataobj/delete/1")
     assert response.status_code == 302
 
 
 def test_get_delete_dataobj(test_app, client: FlaskClient, note_fixture):
-    response = client.get("/dataobj/delete/1")
+    response = client.post("/dataobj/delete/1")
     assert response.status_code == 302
 
 
