8b19fca9927cdec07cc9dd09bdcf2496a5ae69b3
ZoneMinder@@ZoneMinder
diff --git a/web/views/file.php b/web/views/file.php
deleted file mode 100644
index 9b49ff059d..0000000000
--- a/web/views/file.php
+++ /dev/null
@@ -1,56 +0,0 @@
-
diff --git a/web/views/image.php b/web/views/image.php
index a7aacb6d20..df454d792f 100644
--- a/web/views/image.php
+++ b/web/views/image.php
@@ -78,24 +78,23 @@ function imagescale($image, $new_width, $new_height = -1, $mode = 0)
   } else {
     $errorText = "No image path";
   }
-}
-else
-{
-    $path = ZM_DIR_EVENTS . '/' . $_REQUEST['path'];
-    if ( !empty($user['MonitorIds']) )
-    {
-        $imageOk = false;
-        $pathMonId = substr( $path, 0, strspn( $path, "1234567890" ) );
-        foreach ( preg_split( '/["\'\s]*,["\'\s]*/', $user['MonitorIds'] ) as $monId )
-        {
-            if ( $pathMonId == $monId )
-            {
-                $imageOk = true;
-                break;
+} else {
+    $path = realpath(ZM_DIR_EVENTS . '/' . $_REQUEST['path']);
+    if(strpos($path, ZM_DIR_EVENTS) == 0 && strpos($path, ZM_DIR_EVENTS) === true) {   
+        if ( !empty($user['MonitorIds']) ) {
+            $imageOk = false;
+            $pathMonId = substr( $path, 0, strspn( $path, "1234567890" ) );
+            foreach ( preg_split( '/["\'\s]*,["\'\s]*/', $user['MonitorIds'] ) as $monId ) {
+                if ( $pathMonId == $monId ) {
+                    $imageOk = true;
+                    break;
+                }
             }
+            if ( !$imageOk )
+                $errorText = "No image permissions";
         }
-        if ( !$imageOk )
-            $errorText = "No image permissions";
+    } else {
+            $errorText = "Invalid image path";
     }
 }
 
