e090027adcbf62737d5b1f83a9618a9500a49321
zulip@@zulip
diff --git a/static/js/popover_menus.js b/static/js/popover_menus.js
index 77713b68783d3..5037e365d683b 100644
--- a/static/js/popover_menus.js
+++ b/static/js/popover_menus.js
@@ -32,7 +32,6 @@ const default_popover_props = {
     delay: 0,
     appendTo: () => document.body,
     trigger: "click",
-    allowHTML: true,
     interactive: true,
     hideOnClick: true,
     /* The light-border TippyJS theme is a bit of a misnomer; it
@@ -60,6 +59,7 @@ export function initialize() {
     delegate("body", {
         ...default_popover_props,
         target: "#streams_inline_icon",
+        allowHTML: true,
         onShow(instance) {
             const can_create_streams =
                 settings_data.user_can_create_private_streams() ||
@@ -89,6 +89,7 @@ export function initialize() {
         ...default_popover_props,
         target: ".compose_mobile_button",
         placement: "top",
+        allowHTML: true,
         onShow(instance) {
             on_show_prep(instance);
             instance.setContent(
@@ -125,6 +126,7 @@ export function initialize() {
         ...default_popover_props,
         target: ".compose_control_menu_wrapper",
         placement: "top",
+        allowHTML: true,
         onShow(instance) {
             instance.setContent(
                 render_compose_control_buttons_popover({
@@ -143,6 +145,7 @@ export function initialize() {
         ...default_popover_props,
         target: ".enter_sends",
         placement: "top",
+        allowHTML: true,
         onShow(instance) {
             on_show_prep(instance);
             instance.setContent(
diff --git a/static/js/recent_topics_ui.js b/static/js/recent_topics_ui.js
index f86cdb29c120e..c8b8406d55749 100644
--- a/static/js/recent_topics_ui.js
+++ b/static/js/recent_topics_ui.js
@@ -1,4 +1,5 @@
 import $ from "jquery";
+import _ from "lodash";
 
 import render_recent_topic_row from "../templates/recent_topic_row.hbs";
 import render_recent_topics_filters from "../templates/recent_topics_filters.hbs";
@@ -291,7 +292,9 @@ function format_topic(topic_data) {
             ),
         );
     }
-    const other_sender_names = displayed_other_names.join("");
+    const other_sender_names_html = displayed_other_names
+        .map((name) => _.escape(name))
+        .join("");
 
     return {
         // stream info
@@ -309,7 +312,7 @@ function format_topic(topic_data) {
         topic_url: hash_util.by_stream_topic_uri(stream_id, topic),
         senders: senders_info,
         other_senders_count: Math.max(0, all_senders.length - MAX_AVATAR),
-        other_sender_names,
+        other_sender_names_html,
         muted,
         topic_muted,
         participated: topic_data.participated,
diff --git a/static/js/rendered_markdown.js b/static/js/rendered_markdown.js
index 77e1f41447cc9..66774fc9b8750 100644
--- a/static/js/rendered_markdown.js
+++ b/static/js/rendered_markdown.js
@@ -171,7 +171,9 @@ export const update_elements = (content) => {
                 text: rendered_time.text,
             });
             $(this).html(rendered_timestamp);
-            $(this).attr("data-tippy-content", rendered_time.tooltip_content);
+            $(this)
+                .attr("data-tippy-content", rendered_time.tooltip_content_html)
+                .attr("data-tippy-allowHTML", "true");
         } else {
             // This shouldn't happen. If it does, we're very interested in debugging it.
             blueslip.error(`Could not parse datetime supplied by backend: ${time_str}`);
diff --git a/static/js/timerender.ts b/static/js/timerender.ts
index 688ad26a23bcd..7ddf48e7a3267 100644
--- a/static/js/timerender.ts
+++ b/static/js/timerender.ts
@@ -226,17 +226,17 @@ export function render_date(time: Date, time_above: Date | undefined, today: Dat
 // Renders the timestamp returned by the  Markdown syntax.
 export function render_markdown_timestamp(time: number | Date): {
     text: string;
-    tooltip_content: string;
+    tooltip_content_html: string;
 } {
     const hourformat = user_settings.twenty_four_hour_time ? "HH:mm" : "h:mm a";
     const timestring = format(time, "E, MMM d yyyy, " + hourformat);
 
     const tz_offset_str = get_tz_with_UTC_offset(time);
-    const tooltip_html_content = render_markdown_time_tooltip({tz_offset_str});
+    const tooltip_content_html = render_markdown_time_tooltip({tz_offset_str});
 
     return {
         text: timestring,
-        tooltip_content: tooltip_html_content,
+        tooltip_content_html: tooltip_content_html,
     };
 }
 
diff --git a/static/js/tippyjs.js b/static/js/tippyjs.js
index 00705d278eff2..065bb3e46e83e 100644
--- a/static/js/tippyjs.js
+++ b/static/js/tippyjs.js
@@ -35,7 +35,7 @@ tippy.setDefaultProps({
     appendTo: "parent",
 
     // html content is not supported by default
-    // enable it by passing data-tippy-allowHtml="true"
+    // enable it by passing data-tippy-allowHTML="true"
     // in the tag or a parameter.
 });
 
@@ -200,7 +200,6 @@ export function initialize() {
             ".rendered_markdown .copy_codeblock",
             "#compose_top_right [data-tippy-content]",
         ],
-        allowHTML: true,
         appendTo: () => document.body,
         onHidden(instance) {
             instance.destroy();
diff --git a/static/js/ui_init.js b/static/js/ui_init.js
index eef0db7492720..4157ea61c68b5 100644
--- a/static/js/ui_init.js
+++ b/static/js/ui_init.js
@@ -203,7 +203,7 @@ function initialize_compose_box() {
             embedded: $("#compose").attr("data-embedded") === "",
             file_upload_enabled: page_params.max_file_upload_size_mib > 0,
             giphy_enabled: giphy.is_giphy_enabled(),
-            scroll_to_bottom_key: common.has_mac_keyboard()
+            scroll_to_bottom_key_html: common.has_mac_keyboard()
                 ? "Fn + â†’"
                 : "End",
         }),
diff --git a/static/templates/compose.hbs b/static/templates/compose.hbs
index c2ca696dc4b75..86058345ede29 100644
--- a/static/templates/compose.hbs
+++ b/static/templates/compose.hbs
@@ -4,7 +4,7 @@
     minimal css and no JS. We keep it `position: absolute` to prevent
     it changing compose box layout in any way. --}}
     
-        
+        



diff --git a/static/templates/compose_control_buttons.hbs b/static/templates/compose_control_buttons.hbs
index eac9239fbd8a5..cca02a76cca1d 100644
--- a/static/templates/compose_control_buttons.hbs
+++ b/static/templates/compose_control_buttons.hbs
@@ -7,7 +7,7 @@
     


-    
+    

|

diff --git a/static/templates/recent_topic_row.hbs b/static/templates/recent_topic_row.hbs
index b2d2b1acf4d29..fe80d8d808baf 100644
--- a/static/templates/recent_topic_row.hbs
+++ b/static/templates/recent_topic_row.hbs
@@ -32,7 +32,7 @@
     

             {{#if other_senders_count}}
-            
+            
+{{other_senders_count}}

             {{/if}}
diff --git a/static/templates/right_sidebar.hbs b/static/templates/right_sidebar.hbs
index f84458b67ec7d..742039e3ab7aa 100644
--- a/static/templates/right_sidebar.hbs
+++ b/static/templates/right_sidebar.hbs
@@ -27,7 +27,7 @@
             {{t 'Invite more users' }}
             {{/if}}
             
-                
+                



