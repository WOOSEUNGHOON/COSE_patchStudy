552965f33bf79d41ccbec3f1f26840c8bab54ad6
ganglia@@ganglia-web
diff --git a/functions.php b/functions.php
index 7aa93b6d..d288911e 100644
--- a/functions.php
+++ b/functions.php
@@ -365,6 +365,18 @@ function is_valid_hex_color( $string )
     
 }
 
+#------------------------------------------------------------------------------
+# Allowed view name characters are alphanumeric plus space, dash and underscore
+function is_proper_view_name( $string )
+{
+  if(preg_match("/[^a-zA-z0-9_\-\ ]/", $string)){
+    return false;
+  } else {
+    return true;
+  }
+}
+
+
 #------------------------------------------------------------------------------
 # Return a shortened version of a FQDN
 # if "hostname" is numeric only, assume it is an IP instead
diff --git a/get_context.php b/get_context.php
index c7c3baf5..97f9e46f 100644
--- a/get_context.php
+++ b/get_context.php
@@ -15,8 +15,10 @@
 $user['gridname'] = isset($_GET["G"]) ?
     escapeshellcmd( clean_string( rawurldecode($_GET["G"]) ) ) : NULL;
 
-$user['viewname'] = isset($_GET["vn"]) ?
-    escapeshellcmd( clean_string( rawurldecode($_GET["vn"]) ) ) : '';
+$user['viewname'] = '';
+if ( isset($_GET["vn"]) &&  is_proper_view_name ($_GET["vn"]) ) {
+    $user['viewname'] = $_GET["vn"];
+}
 
 if($conf['case_sensitive_hostnames'] == 1) {
     $user['hostname'] = isset($_GET["h"]) ?
diff --git a/views.php b/views.php
deleted file mode 100644
index a99e9305..00000000
--- a/views.php
+++ /dev/null
@@ -1,55 +0,0 @@
-
-
-
-
-
-
-
-
-
-
-  
-
- $view) {
-    if ($view['view_name'] == $view_name) {
-      $view_elements = get_view_graph_elements($view);
-      $range_args = "";
-      if (isset($_GET['r']) && $_GET['r'] != "") 
-	$range_args .= "&r=" . rawurlencode($_GET['r']);
-      if (isset($_GET['cs']) && isset($_GET['ce'])) 
-	$range_args .= "&cs=" . rawurlencode($_GET['cs']) . "&ce=" . rawurlencode($_GET['ce']);
-
-      if (count($view_elements) != 0) {
-	foreach ($view_elements as $id => $element) {
-	  $legend = isset($element['hostname']) ? $element['hostname'] : "Aggregate graph";
-          $base = isset($_GET['base']) ? rawurlencode($_GET['base']) : '.';
-	  print "";
-	}
-      } else {
-	print "No graphs defined for this view. Please add some";
-      }
-    }
-  } 
-?>
-  
-
-
-
diff --git a/views_view.php b/views_view.php
index 3ec6f5a2..5ab6e69f 100644
--- a/views_view.php
+++ b/views_view.php
@@ -6,6 +6,20 @@
 if (! checkAccess(GangliaAcl::ALL_VIEWS, GangliaAcl::VIEW, $conf))
   die("You do not have access to view views.");
 
+$user['view_name'] = $_REQUEST['view_name'];
+
+if( !is_proper_view_name ( $user['view_name'])){
+?>
+
+   
+     
+    View names valid characters are 0-9, a-z, A-Z, -, _ and space. View has not been created.
+  
+
+ $view) {
-      if ($view['view_name'] == $_GET['view_name']) {
+      if ($view['view_name'] == $user['view_name']) {
         $view_exists = 1;
+        break;
       }
     }
 
     if ($view_exists == 1) {
       $output = "Alert: View with the name " .
-                $_GET['view_name'] . 
+                $user['view_name'] . 
                 " already exists.";
     } else {
-      $empty_view = array ("view_name" => $_GET['view_name'],
+      $empty_view = array ("view_name" => $user['view_name'],
                            "items" => array());
-      $view_suffix = str_replace(" ", "_", $_GET['view_name']);
+      $view_suffix = str_replace(" ", "_", $user['view_name']);
       $view_filename = $conf['views_dir'] . "/view_" . preg_replace('/[^a-zA-Z0-9_-]/', '', $view_suffix) . ".json";
       if ( pathinfo( $view_filename, PATHINFO_DIRNAME ) != $conf['views_dir'] ) {
         die('Invalid path detected');
@@ -71,17 +86,18 @@
     $available_views = get_available_views();
 
     foreach ($available_views as $view_id => $view) {
-      if ($view['view_name'] == $_GET['view_name']) {
+      if ($view['view_name'] == $user['view_name']) {
         $view_exists = 1;
+        break;
       }
     }
 
     if ($view_exists != 1) {
       $output = "Alert: View with the name " .
-      $_GET['view_name'] . 
+      $user['view_name'] . 
       " does not exist.";
     } else {
-      $view_suffix = str_replace(" ", "_", $_GET['view_name']);
+      $view_suffix = str_replace(" ", "_", $user['view_name']);
       $view_filename = $conf['views_dir'] . "/view_" . preg_replace('/[^a-zA-Z0-9_-]/', '', $view_suffix) . ".json";
       if ( pathinfo( $view_filename, PATHINFO_DIRNAME ) != $conf['views_dir'] ) {
         die('Invalid path detected');
@@ -109,7 +125,7 @@
     $available_views = get_available_views();
 
     foreach ($available_views as $view_id => $view) {
-      if ($view['view_name'] == $_GET['view_name']) {
+      if ($view['view_name'] == $user['view_name']) {
         $view_exists = 1;
         break;
       }
@@ -117,7 +133,7 @@
 
     if ($view_exists == 0) {
       $output = "Alert: View " .
-      $_GET['view_name'] . 
+      $user['view_name'] . 
       " does not exist. This should not happen.";
     } else {
       // Read in contents of an existing view
