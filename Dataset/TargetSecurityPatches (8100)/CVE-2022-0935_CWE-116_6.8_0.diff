ce96791cb4c7420266b668fc234c211914259ba7
livehelperchat@@livehelperchat
diff --git a/lhc_web/cli/lib/install.php b/lhc_web/cli/lib/install.php
index 1b62317f08..12d22b3e5d 100644
--- a/lhc_web/cli/lib/install.php
+++ b/lhc_web/cli/lib/install.php
@@ -1267,9 +1267,9 @@ function step3() {
                   PRIMARY KEY (`identifier`)
                 ) ENGINE=InnoDB CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;");
 
-            $randomHash = erLhcoreClassModelForgotPassword::randomPassword(9);
+            $randomHash = erLhcoreClassModelForgotPassword::randomPassword(80);
             $randomHashLength = strlen($randomHash);
-            $exportHash = erLhcoreClassModelForgotPassword::randomPassword(9);
+            $exportHash = erLhcoreClassModelForgotPassword::randomPassword(80);
 
             if (extension_loaded('bcmath')){
                 $geoRow = "('geo_data','a:5:{i:0;b:0;s:21:\"geo_detection_enabled\";i:1;s:22:\"geo_service_identifier\";s:8:\"max_mind\";s:23:\"max_mind_detection_type\";s:7:\"country\";s:22:\"max_mind_city_location\";s:37:\"var/external/geoip/GeoLite2-City.mmdb\";}',0,'',1)";
diff --git a/lhc_web/design/defaulttheme/tpl/lhbrowseoffer/getstatus.tpl.php b/lhc_web/design/defaulttheme/tpl/lhbrowseoffer/getstatus.tpl.php
index b7b9fa3a75..52ce018dbd 100644
--- a/lhc_web/design/defaulttheme/tpl/lhbrowseoffer/getstatus.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhbrowseoffer/getstatus.tpl.php
@@ -54,7 +54,7 @@
         var th = document.getElementsByTagName('head')[0];

         var s = document.createElement('script');

         s.setAttribute('type','text/javascript');

-        s.setAttribute('src','current_value?>///hash?>');

+        s.setAttribute('src','/hash?>');

         th.appendChild(s);

         this.removeById('lhc_container_browseoffer');

         this.removeById('lhc_browseoffer-bg');

@@ -73,7 +73,7 @@
 		

    		  custom_iframe_url != '' || $invite->lhc_iframe_content == 1) : ?>

    		  this.iframe_html = '';

          

          this.iframe_html = ""+content)?>+"";

@@ -102,7 +102,7 @@
          var th = document.getElementsByTagName('head')[0];

          var s = document.createElement('script');

          s.setAttribute('type','text/javascript');

-         s.setAttribute('src','current_value?>///hash?>');

+         s.setAttribute('src','/hash?>');

          th.appendChild(s);

          

          if (.openCallback) {

diff --git a/lhc_web/design/defaulttheme/tpl/lhbrowseoffer/htmlcode.tpl.php b/lhc_web/design/defaulttheme/tpl/lhbrowseoffer/htmlcode.tpl.php
index a2f8632ba3..f7a0110adf 100644
--- a/lhc_web/design/defaulttheme/tpl/lhbrowseoffer/htmlcode.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhbrowseoffer/htmlcode.tpl.php
@@ -96,7 +96,7 @@ function generateEmbedCode(){
         'var po = document.createElement(\'script\'); po.type = \'text/javascript\'; po.async = true;'+"\n"+
         'var referrer = (document.referrer) ? encodeURIComponent(document.referrer.substr(document.referrer.indexOf(\'://\')+1)) : \'\';'+"\n"+
         'var location  = (document.location) ? encodeURIComponent(window.location.href.substring(window.location.protocol.length)) : \'\';'+"\n"+
-        'po.src = \''+$('#HttpMode').val()+'//'+siteAccess+'browseoffer/getstatus'+size+id_size_height+topposition+id_timeout+id_show_overlay+id_identifier+id_canreopen+'?r=\'+referrer+\'&l=\'+location;'+"\n"+
+        'po.src = \''+$('#HttpMode').val()+'//'+siteAccess+'browseoffer/getstatus'+size+id_size_height+topposition+id_timeout+id_show_overlay+id_identifier+id_canreopen+'?r=\'+referrer+\'&l=\'+location;'+"\n"+
         'var s = document.getElementsByTagName(\'script\')[0]; s.parentNode.insertBefore(po, s);'+"\n"+
       '})();'+"\n"+
     '';
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/chat_tabs/information_rows/id.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/chat_tabs/information_rows/id.tpl.php
index bd745cfe93..2194578d2f 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/chat_tabs/information_rows/id.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/chat_tabs/information_rows/id.tpl.php
@@ -1,5 +1,5 @@
 


-    vpn_keyid;?>linkCopy link

+    vpn_keyid;?>linkCopy link


\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/chatcheckoperatormessage.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/chatcheckoperatormessage.tpl.php
index 9474026e90..9abc3192a9 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/chatcheckoperatormessage.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/chatcheckoperatormessage.tpl.php
@@ -11,7 +11,7 @@
     setTimeout(function() {
     
 
-        var invitationURL =  'current_value?>///(vid)/invitation_assigned == true ? print '/(playsound)/true' : ''?>/(fullheight)/';
+        var invitationURL =  '/(vid)/invitation_assigned == true ? print '/(playsound)/true' : ''?>/(fullheight)/';
 
         invitation->design_data_array['mobile_html']) && $visitor->invitation->design_data_array['mobile_html'] != '') : ?>
 
@@ -19,7 +19,7 @@
                 current_value . '//' . $_SERVER['HTTP_HOST'] . $visitor->invitation->{'design_data_img_' . $i . '_url'};
+                        $replaceStyleArray['{proactive_img_' . $i . '}'] = erLhcoreClassSystem::getHost() . $visitor->invitation->{'design_data_img_' . $i . '_url'};
                     }
                 ?>
                 invitation instanceof erLhAbstractModelProactiveChatInvitation && (($visitor->invitation_assigned == false && $visitor->invitation->delay > 0) || $visitor->invitation->delay_init > 0)) : ?>
                 setTimeout(function() {
             
-            var urlInvitation = 'current_value?>///(vid)/invitation_assigned == true ? print '/(playsound)/true' : ''?>/(fullheight)/';
+            var urlInvitation = '/(vid)/invitation_assigned == true ? print '/(playsound)/true' : ''?>/(fullheight)/';
             invitation instanceof erLhAbstractModelProactiveChatInvitation && isset($visitor->invitation->design_data_array['api_do_not_show']) && $visitor->invitation->design_data_array['api_do_not_show'] == 1) : ?>
                 lh_inst.showBasicInvitation(urlInvitation);
             
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getmessagesnippet/operator_profile.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getmessagesnippet/operator_profile.tpl.php
index ebc141ff90..5faa77bbee 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getmessagesnippet/operator_profile.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getmessagesnippet/operator_profile.tpl.php
@@ -3,7 +3,7 @@
         has_photo) : ?>
             

-            
+            


account_box
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus.tpl.php
index edfaee94fa..1983e117ce 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus.tpl.php
@@ -51,7 +51,7 @@
 	is_full_height : ,
 	online_tracked : false,
     urlopen : function(){
-    	return "current_value?>//"+this.lang+"/chat/startchatid : ''?>"+this.survey_id;
+    	return ""+this.lang+"/chat/startchatid : ''?>"+this.survey_id;
     },
 	
     hasSurvey : ,
@@ -266,7 +266,7 @@
             var th = document.getElementsByTagName('head')[0];
             var s = document.createElement('script');
             s.setAttribute('type','text/javascript');
-            s.setAttribute('src','current_value?>//'+this.lang+'/chat/chatwidgetclosed'+this.getAppendCookieArguments()+'?ts='+Date.now());
+            s.setAttribute('src',''+this.lang+'/chat/chatwidgetclosed'+this.getAppendCookieArguments()+'?ts='+Date.now());
             th.appendChild(s);
             this.toggleStatusWidget(false);
 
@@ -593,7 +593,7 @@
 
     updateAttribute : function(attributes) {
         var xhr = new XMLHttpRequest();
-        xhr.open( "POST", 'current_value?>//'+this.lang+'/chat/updateattribute'+this.getAppendCookieArguments(), true);
+        xhr.open( "POST", ''+this.lang+'/chat/updateattribute'+this.getAppendCookieArguments(), true);
      	xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
      	xhr.send( "data=" + encodeURIComponent( this.JSON.stringify(attributes) ) );
     },
@@ -610,7 +610,7 @@
             var s = document.createElement('script');
             s.setAttribute('id','lhc_operator_message');
             s.setAttribute('type','text/javascript');
-            s.setAttribute('src','current_value?>//'+lh_inst.lang+'/chat/chatcheckoperatormessageid : ''?>/(vid)/'+vid + lh_inst.survey_id + '/(uactiv)/'+lh_inst.userActive+'/(wopen)/'+lh_inst.timeoutStatusWidgetOpen+dynamic+'?l='+locationCurrent+inst.tag+'&dt='+encodeURIComponent(document.title)+'&ts='+Date.now());
+            s.setAttribute('src',''+lh_inst.lang+'/chat/chatcheckoperatormessageid : ''?>/(vid)/'+vid + lh_inst.survey_id + '/(uactiv)/'+lh_inst.userActive+'/(wopen)/'+lh_inst.timeoutStatusWidgetOpen+dynamic+'?l='+locationCurrent+inst.tag+'&dt='+encodeURIComponent(document.title)+'&ts='+Date.now());
             th.appendChild(s);
             lh_inst.startNewMessageCheck();
         }, data['check_for_operator_msg']*1000); ?> );*/ ?>
@@ -652,7 +652,7 @@
 
             s.setAttribute('id','lhc_operator_message');
             s.setAttribute('type','text/javascript');
-            s.setAttribute('src','current_value?>//'+this.lang+'/chat/chatcheckoperatormessageid : ''?>/(tz)/' + tzOffset + this.survey_id + '/(count_page)/1/(vid)/'+vid+'/(uactiv)/'+lh_inst.userActive+'/(wopen)/'+lh_inst.timeoutStatusWidgetOpen+dynamic+'?l='+locationCurrent+this.tag+this.parseStorageArguments()+this.parseOptionsOnline()+this.parseOptions()+'&dt='+encodeURIComponent(document.title)+'&ts='+Date.now());
+            s.setAttribute('src',''+this.lang+'/chat/chatcheckoperatormessageid : ''?>/(tz)/' + tzOffset + this.survey_id + '/(count_page)/1/(vid)/'+vid+'/(uactiv)/'+lh_inst.userActive+'/(wopen)/'+lh_inst.timeoutStatusWidgetOpen+dynamic+'?l='+locationCurrent+this.tag+this.parseStorageArguments()+this.parseOptionsOnline()+this.parseOptions()+'&dt='+encodeURIComponent(document.title)+'&ts='+Date.now());
             th.appendChild(s);
         }
     },
@@ -665,13 +665,13 @@
         var tzOffset = this.getTzOffset();
         s.setAttribute('id','lhc_log_pageview');
         s.setAttribute('type','text/javascript');
-        s.setAttribute('src','current_value?>//'+this.lang+'/chat/logpageview/(tz)/'+tzOffset+'/(vid)/' + vid + this.survey_id + '/(uactiv)/'+lh_inst.userActive+'/(wopen)/'+lh_inst.timeoutStatusWidgetOpen+'?l='+locationCurrent+this.parseStorageArguments()+this.parseOptionsOnline()+'&dt='+encodeURIComponent(document.title)+'&ts='+Date.now());
+        s.setAttribute('src',''+this.lang+'/chat/logpageview/(tz)/'+tzOffset+'/(vid)/' + vid + this.survey_id + '/(uactiv)/'+lh_inst.userActive+'/(wopen)/'+lh_inst.timeoutStatusWidgetOpen+'?l='+locationCurrent+this.parseStorageArguments()+this.parseOptionsOnline()+'&dt='+encodeURIComponent(document.title)+'&ts='+Date.now());
         th.appendChild(s);
     },
 
     updateJSVars : function(vars){
         var xhr = new XMLHttpRequest();
-        xhr.open( "POST", 'current_value?>//'+this.lang+'/chat/updatejsvars'+this.getAppendCookieArguments(), true);
+        xhr.open( "POST", ''+this.lang+'/chat/updatejsvars'+this.getAppendCookieArguments(), true);
         xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
         xhr.send( "data=" + encodeURIComponent( this.JSON.stringify(vars) ) );
     },
@@ -680,7 +680,7 @@
         if (typeof .events != 'undefined') {
             if (.events.length > 0) {
                  var xhr = new XMLHttpRequest();
-                 xhr.open( "POST", 'current_value?>//'+this.lang+'/chat/logevent'+this.getAppendCookieArguments(), true);
+                 xhr.open( "POST", ''+this.lang+'/chat/logevent'+this.getAppendCookieArguments(), true);
              	 xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
              	 xhr.send( "data=" + encodeURIComponent( this.JSON.stringify(.events) ) );
              	 .events = new Array();
@@ -724,7 +724,7 @@
             this.cookieDataPers['ex'] = Math.round(Date.now()/100000000)+10;
             this.storePersistenCookie();
             var xhr = new XMLHttpRequest();
-            xhr.open( "GET", 'current_value?>//'+this.lang+'/chat/extendcookie/'+this.cookieDataPers.vid, true);
+            xhr.open( "GET", ''+this.lang+'/chat/extendcookie/'+this.cookieDataPers.vid, true);
             xhr.send();
         }
     },
@@ -746,7 +746,7 @@
 				var inst = this;
 				setTimeout(function(){
 					var xhr = new XMLHttpRequest();
-			        xhr.open( "POST", 'current_value?>//'+inst.lang+'/chat/setnewvid', true);
+			        xhr.open( "POST", ''+inst.lang+'/chat/setnewvid', true);
 			     	xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
 			     	xhr.send( "data=" + encodeURIComponent( inst.JSON.stringify({'vid':old,'new':vid}) ) );
 				},1000);
@@ -809,7 +809,7 @@
 		   		var th = document.getElementsByTagName('head')[0];
 		        var s = document.createElement('script');
 		        s.setAttribute('type','text/javascript');
-		        s.setAttribute('src','current_value?>//');
+		        s.setAttribute('src','');
 		        th.appendChild(s);
 		        s.onreadystatechange = s.onload = function(){
 		        	inst.makeScreenshot();
@@ -819,7 +819,7 @@
 				  	html2canvas(document.body, {
 						  onrendered: function(canvas) {
 						         var xhr = new XMLHttpRequest();
-						         xhr.open( "POST", 'current_value?>//'+lh_inst.lang+'/file/storescreenshot'+inst.getAppendCookieArguments(), true);
+						         xhr.open( "POST", ''+lh_inst.lang+'/file/storescreenshot'+inst.getAppendCookieArguments(), true);
 							     xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
 							     xhr.send( "data=" + encodeURIComponent( canvas.toDataURL() ) );
 						  }
@@ -843,7 +843,7 @@
         var tzOffset = this.getTzOffset();
         s.setAttribute('id','lhc_finish_shr');
         s.setAttribute('type','text/javascript');
-        s.setAttribute('src','current_value?>//'+lh_inst.lang+'/cobrowse/finishsession/(sharemode)/'+lh_inst.sharemode+lh_inst.getAppendCookieArguments());
+        s.setAttribute('src',''+lh_inst.lang+'/cobrowse/finishsession/(sharemode)/'+lh_inst.sharemode+lh_inst.getAppendCookieArguments());
         th.appendChild(s);
         this.cobrowser = null;
     },
@@ -863,7 +863,7 @@
 			   		var th = document.getElementsByTagName('head')[0];
 			        var s = document.createElement('script');
 			        s.setAttribute('type','text/javascript');
-			        s.setAttribute('src','current_value?>//');
+			        s.setAttribute('src','');
 			        th.appendChild(s);
 			        s.onreadystatechange = s.onload = function(){
 			        	inst.startCoBrowse(inst.sharehash,this.sharemode);
@@ -969,7 +969,7 @@
         var s = document.createElement('script');
         s.setAttribute('id','lhc_check_status');
         s.setAttribute('type','text/javascript');
-        s.setAttribute('src','current_value?>//'+this.lang+'/chat/chatcheckstatus/(status)/' + this.isOnline + this.survey_id + (this.cookieDataPers.vid ? '/(vid)/'+this.cookieDataPers.vid : '')+ hashAppend + hashResume + '/(uactiv)/'+this.userActive+'/(wopen)/'+this.timeoutStatusWidgetOpen + '/(uaction)/'+sender+'/(isproactive)/'+this.isProactivePending+'/?ts='+Date.now());
+        s.setAttribute('src',''+this.lang+'/chat/chatcheckstatus/(status)/' + this.isOnline + this.survey_id + (this.cookieDataPers.vid ? '/(vid)/'+this.cookieDataPers.vid : '')+ hashAppend + hashResume + '/(uactiv)/'+this.userActive+'/(wopen)/'+this.timeoutStatusWidgetOpen + '/(uaction)/'+sender+'/(isproactive)/'+this.isProactivePending+'/?ts='+Date.now());
         th.appendChild(s);
     },
 
@@ -986,7 +986,7 @@
 
     refreshCustomFields : function() {
         var xhr = new XMLHttpRequest();
-        xhr.open( "POST", 'current_value?>//'+lh_inst.lang+'/chat/refreshcustomfields'+this.getAppendCookieArguments() , true);
+        xhr.open( "POST", ''+lh_inst.lang+'/chat/refreshcustomfields'+this.getAppendCookieArguments() , true);
 	    xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
 	    xhr.send(this.parseOptions());
     },
@@ -1032,7 +1032,7 @@
         var s = document.createElement('script');
         s.setAttribute('type','text/javascript');
         var optionsParts = options.split('_');
-        s.setAttribute('src','current_value?>//'+this.lang+'/chat/htmlsnippet/'+messageId+'/'+optionsParts[0]+"/"+optionsParts[1]+'/(status)/' + this.isOnline + this.survey_id + (this.cookieDataPers.vid ? '/(vid)/'+this.cookieDataPers.vid : '')+ hashAppend + hashResume + '/(uactiv)/'+this.userActive+'/(wopen)/'+this.timeoutStatusWidgetOpen + '/(isproactive)/'+this.isProactivePending+'/?ts='+Date.now());
+        s.setAttribute('src',''+this.lang+'/chat/htmlsnippet/'+messageId+'/'+optionsParts[0]+"/"+optionsParts[1]+'/(status)/' + this.isOnline + this.survey_id + (this.cookieDataPers.vid ? '/(vid)/'+this.cookieDataPers.vid : '')+ hashAppend + hashResume + '/(uactiv)/'+this.userActive+'/(wopen)/'+this.timeoutStatusWidgetOpen + '/(isproactive)/'+this.isProactivePending+'/?ts='+Date.now());
         th.appendChild(s);
     },
 
@@ -1045,7 +1045,7 @@
 
         // We allow to send events only from chat installation or page where script is embeded.
         if (
-            originDomain !== '' &&
+            originDomain !== '' &&
             originDomain !== document.domain &&
             action != 'lhc_sizing_chat_survey' &&
             action != 'lh_survey_runed' &&
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/container.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/container.tpl.php
index d3c40cfb25..bdb2f19ce4 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/container.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/container.tpl.php
@@ -8,15 +8,15 @@
 ?>
 modern_look == 0) : ?>
 this.iframe_html = '>' +
-    'bot_configuration_array['custom_html_header'])) : ?>bot_configuration_array['custom_html_header'])?>bot_configuration_array['custom_html_header_body'])) : ?>bot_configuration_array['custom_html_header_body'])?>hide_close == 0) : ?>current_value == 0 && ($theme === false || $theme->hide_popup == 0)) : ?>' +
+    'bot_configuration_array['custom_html_header'])) : ?>bot_configuration_array['custom_html_header'])?>bot_configuration_array['custom_html_header_body'])) : ?>bot_configuration_array['custom_html_header_body'])?>hide_close == 0) : ?>current_value == 0 && ($theme === false || $theme->hide_popup == 0)) : ?>' +
     this.iframe_html + '';
-raw_css = "#.-min {overflow:hidden}#_remote_window{padding-left:5px;}.-min #_header{min-width:107px} .-min #_iframe_container{display:none} .-no-transition{ -webkit-transition: none !important; -moz-transition: none !important;-o-transition: none !important;-ms-transition: none !important;transition: none !important;}\n#.-delayed{visibility:hidden;position: fixed;left: -90000px!important;right: auto!important;}#.-delayed .-cf{display:none}\n# * {line-height:100%;direction:getOverrideValue('site', 'dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;line-height:100%;box-sizing: content-box;-moz-box-sizing:content-box;padding:0;margin:0;}\n# img {border:0;}\n#_header{position:relative;z-index:2147483640;height:header_height > 0) ? print $theme->header_height : print '17' ?>px;overflow:hidden;text-align:right;clear:both;background-color:#header_background : print '525252' ?>;padding:header_padding > 0) ? print $theme->header_padding : print '5' ?>px;}#-msg-number{float: left;color: #FFF;font-size: 12px;font-weight: bold;padding-left: 5px;line-height: 20px;} \n#_min{float:left;padding:2px;}#_remote_window,#_close{padding:2px;float:right;}.-min #_min:before{content:url(restore_image_url != '') : ?>restore_image_url;?>current_value?>//)}#_min:before{content: url('minimize_image_url != '') : ?>minimize_image_url;?>current_value?>//'); position: relative;left:0;top;0} #_min{width:14px;height:14px;}\n#_close:hover,#_min:hover,#_remote_window:hover{opacity:0.4;}\n# {background-color:#FFF;-moz-user-select:none; -khtml-user-drag:element;cursor: move;cursor: -moz-grab;cursor: -webkit-grab;max-height: 100%;overflow: auto;\nz-index:2147483640;\n position: fixed;;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);-moz-box-shadow:  rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px; }\n# iframe{position:relative;display:block;}\n# #_iframe_container{border:widget_border_width > 0) ? print $theme->widget_border_width : print '1' ?>px solid #widget_border_color : print 'cccccc' ?>;border-top: 0;border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;overflow: hidden;}\n# iframe.-loading{\nbackground: #FFF url(current_value?>//) no-repeat center center; }\n@media only screen and (max-device-width : widget_response_width > 0) ? print $theme->widget_response_width : print 992?>px) { .-opened{position: fixed; overflow: hidden; right: 0px; left: 0px; top: 0px; bottom: 0px;} #_header{height:30px;} #_header a{padding:7px;}#{position:fixed;left:0!important;right:0!important;bottom:0!important;top:0!important;border:0;border-radius:0}# #_iframe_container{border:0;height: calc(100% - 40px)}# iframe{width:100% !important;height: 100%!important} .-min #_header a{padding:2px;} #.-min{}}";
+raw_css = "#.-min {overflow:hidden}#_remote_window{padding-left:5px;}.-min #_header{min-width:107px} .-min #_iframe_container{display:none} .-no-transition{ -webkit-transition: none !important; -moz-transition: none !important;-o-transition: none !important;-ms-transition: none !important;transition: none !important;}\n#.-delayed{visibility:hidden;position: fixed;left: -90000px!important;right: auto!important;}#.-delayed .-cf{display:none}\n# * {line-height:100%;direction:getOverrideValue('site', 'dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;line-height:100%;box-sizing: content-box;-moz-box-sizing:content-box;padding:0;margin:0;}\n# img {border:0;}\n#_header{position:relative;z-index:2147483640;height:header_height > 0) ? print $theme->header_height : print '17' ?>px;overflow:hidden;text-align:right;clear:both;background-color:#header_background : print '525252' ?>;padding:header_padding > 0) ? print $theme->header_padding : print '5' ?>px;}#-msg-number{float: left;color: #FFF;font-size: 12px;font-weight: bold;padding-left: 5px;line-height: 20px;} \n#_min{float:left;padding:2px;}#_remote_window,#_close{padding:2px;float:right;}.-min #_min:before{content:url(restore_image_url != '') : ?>restore_image_url;?>)}#_min:before{content: url('minimize_image_url != '') : ?>minimize_image_url;?>'); position: relative;left:0;top;0} #_min{width:14px;height:14px;}\n#_close:hover,#_min:hover,#_remote_window:hover{opacity:0.4;}\n# {background-color:#FFF;-moz-user-select:none; -khtml-user-drag:element;cursor: move;cursor: -moz-grab;cursor: -webkit-grab;max-height: 100%;overflow: auto;\nz-index:2147483640;\n position: fixed;;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);-moz-box-shadow:  rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px; }\n# iframe{position:relative;display:block;}\n# #_iframe_container{border:widget_border_width > 0) ? print $theme->widget_border_width : print '1' ?>px solid #widget_border_color : print 'cccccc' ?>;border-top: 0;border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;overflow: hidden;}\n# iframe.-loading{\nbackground: #FFF url() no-repeat center center; }\n@media only screen and (max-device-width : widget_response_width > 0) ? print $theme->widget_response_width : print 992?>px) { .-opened{position: fixed; overflow: hidden; right: 0px; left: 0px; top: 0px; bottom: 0px;} #_header{height:30px;} #_header a{padding:7px;}#{position:fixed;left:0!important;right:0!important;bottom:0!important;top:0!important;border:0;border-radius:0}# #_iframe_container{border:0;height: calc(100% - 40px)}# iframe{width:100% !important;height: 100%!important} .-min #_header a{padding:2px;} #.-min{}}";
 
 this.iframe_html = '>' +
                               '☰hide_close == 0) : ?>current_value == 0 && ($theme === false || $theme->hide_popup == 0)) : ?>' +
+                              '" id="_status-icon-restore" href="#" >☰hide_close == 0) : ?>current_value == 0 && ($theme === false || $theme->hide_popup == 0)) : ?>' +
                               this.iframe_html + '';
 
-raw_css = "#.-min {overflow:hidden}# .status-icon{display:none;}#.-min .status-icon{display:inline-block;;;-webkit-box-shadow:  rgba(50, 50, 50, 0.5);-moz-box-shadow: rgba(50, 50, 50, 0.5);box-shadow:  rgba(50, 50, 50, 0.5);text-decoration:none;height:41px;width:41px;font-weight:bold;color:text_color : print '#000' ?>;display:block;padding:10px;background:#onl_bcolor : print '0c8fc4' ?> url('online_image_url !== false) : print $theme->online_image_url; else : ?>current_value?>//') no-repeat center center}#.-min .status-icon.offline-status-icon{background:#888888 url('offline_image_url !== false) : print $theme->offline_image_url; else : ?>current_value?>//') no-repeat center center} #_remote_window{padding-left:5px;}.-min #_header{min-width:107px} .-min #_iframe_container{display:none} .-no-transition{ -webkit-transition: none !important; -moz-transition: none !important;-o-transition: none !important;-ms-transition: none !important;transition: none !important;}\n#.-delayed{visibility:hidden;position: fixed;left: -90000px!important;right: auto!important;}#.-delayed .-cf{display:none}\n# * {line-height:100%;direction:getOverrideValue('site', 'dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;line-height:100%;box-sizing: content-box;-moz-box-sizing:content-box;padding:0;margin:0;}\n# img {border:0;max-width: none}\n#_header{position:relative;z-index:2147483640;height:header_height > 0) ? print $theme->header_height : print '17' ?>px;text-align:right;clear:both;background-color:#header_background : print '525252' ?>;padding:header_padding > 0) ? print $theme->header_padding : print '5' ?>px;}#-msg-number{float: left;color: #ffffff;font-size: 12px;font-weight: normal;line-height: 23px;position: absolute;background-color: red;border-radius: 37px;display: inline-block;padding-left: 8px;padding-right: 8px;margin-top: -5px;margin-left: -4px;} \n#_min{float:right;padding:2px;}.-min #_min:before{content:url(current_value?>//restore_image_url != '') : ?>restore_image_url;?>)}#_min:before{content: url('minimize_image_url != '') : ?>minimize_image_url;?>current_value?>//'); position: relative;left:0;top;0} #_min{width:14px;height:14px;}\n#_min:hover{opacity:0.4;}\n# {background-color:#FFF;-moz-user-select:none; -khtml-user-drag:element;cursor: move;cursor: -moz-grab;cursor: -webkit-grab;max-height: 100%;	overflow: auto;\nz-index:2147483640;\n position: fixed;;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);-moz-box-shadow:  rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px; }\n# iframe{position:relative;display:block;}\n# #_iframe_container{border:widget_border_width > 0) ? print $theme->widget_border_width : print '1' ?>px solid #widget_border_color : print 'cccccc' ?>;border-top: 0;border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;overflow: hidden;}\n# iframe.-loading{\nbackground: #FFF url(current_value?>//) no-repeat center center; }\n@media only screen and (max-device-width : widget_response_width > 0) ? print $theme->widget_response_width : print 992?>px) {ul.-cf li ul a{padding:8px 14px!important} ul.-cf li:hover ul, ul.-cf li ul {top: 30px;} .-opened{position: fixed; overflow: hidden; right: 0px; left: 0px; top: 0px; bottom: 0px;} #_header{height:30px;} #_header a{padding:7px;}#{position:fixed;left:0!important;right:0!important;bottom:0!important;top:0!important;border:0;border-radius:0}# #_iframe_container{border:0;height: calc(100% - 40px)}# iframe{width:100% !important;height: 100%!important}} .-min #_header{display:none;}.-min #_header a{padding:2px;} #.-min .status-icon{;;-webkit-box-shadow:  rgba(50, 50, 50, 0.5);-moz-box-shadow: rgba(50, 50, 50, 0.5);box-shadow:  rgba(50, 50, 50, 0.5);text-decoration:none;height:41px;width:41px;}#.-min{}";
+raw_css = "#.-min {overflow:hidden}# .status-icon{display:none;}#.-min .status-icon{display:inline-block;;;-webkit-box-shadow:  rgba(50, 50, 50, 0.5);-moz-box-shadow: rgba(50, 50, 50, 0.5);box-shadow:  rgba(50, 50, 50, 0.5);text-decoration:none;height:41px;width:41px;font-weight:bold;color:text_color : print '#000' ?>;display:block;padding:10px;background:#onl_bcolor : print '0c8fc4' ?> url('online_image_url !== false) : print $theme->online_image_url; else : ?>') no-repeat center center}#.-min .status-icon.offline-status-icon{background:#888888 url('offline_image_url !== false) : print $theme->offline_image_url; else : ?>') no-repeat center center} #_remote_window{padding-left:5px;}.-min #_header{min-width:107px} .-min #_iframe_container{display:none} .-no-transition{ -webkit-transition: none !important; -moz-transition: none !important;-o-transition: none !important;-ms-transition: none !important;transition: none !important;}\n#.-delayed{visibility:hidden;position: fixed;left: -90000px!important;right: auto!important;}#.-delayed .-cf{display:none}\n# * {line-height:100%;direction:getOverrideValue('site', 'dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;line-height:100%;box-sizing: content-box;-moz-box-sizing:content-box;padding:0;margin:0;}\n# img {border:0;max-width: none}\n#_header{position:relative;z-index:2147483640;height:header_height > 0) ? print $theme->header_height : print '17' ?>px;text-align:right;clear:both;background-color:#header_background : print '525252' ?>;padding:header_padding > 0) ? print $theme->header_padding : print '5' ?>px;}#-msg-number{float: left;color: #ffffff;font-size: 12px;font-weight: normal;line-height: 23px;position: absolute;background-color: red;border-radius: 37px;display: inline-block;padding-left: 8px;padding-right: 8px;margin-top: -5px;margin-left: -4px;} \n#_min{float:right;padding:2px;}.-min #_min:before{content:url(restore_image_url != '') : ?>restore_image_url;?>)}#_min:before{content: url('minimize_image_url != '') : ?>minimize_image_url;?>'); position: relative;left:0;top;0} #_min{width:14px;height:14px;}\n#_min:hover{opacity:0.4;}\n# {background-color:#FFF;-moz-user-select:none; -khtml-user-drag:element;cursor: move;cursor: -moz-grab;cursor: -webkit-grab;max-height: 100%;	overflow: auto;\nz-index:2147483640;\n position: fixed;;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);-moz-box-shadow:  rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px; }\n# iframe{position:relative;display:block;}\n# #_iframe_container{border:widget_border_width > 0) ? print $theme->widget_border_width : print '1' ?>px solid #widget_border_color : print 'cccccc' ?>;border-top: 0;border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;overflow: hidden;}\n# iframe.-loading{\nbackground: #FFF url() no-repeat center center; }\n@media only screen and (max-device-width : widget_response_width > 0) ? print $theme->widget_response_width : print 992?>px) {ul.-cf li ul a{padding:8px 14px!important} ul.-cf li:hover ul, ul.-cf li ul {top: 30px;} .-opened{position: fixed; overflow: hidden; right: 0px; left: 0px; top: 0px; bottom: 0px;} #_header{height:30px;} #_header a{padding:7px;}#{position:fixed;left:0!important;right:0!important;bottom:0!important;top:0!important;border:0;border-radius:0}# #_iframe_container{border:0;height: calc(100% - 40px)}# iframe{width:100% !important;height: 100%!important}} .-min #_header{display:none;}.-min #_header a{padding:2px;} #.-min .status-icon{;;-webkit-box-shadow:  rgba(50, 50, 50, 0.5);-moz-box-shadow: rgba(50, 50, 50, 0.5);box-shadow:  rgba(50, 50, 50, 0.5);text-decoration:none;height:41px;width:41px;}#.-min{}";
 
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/dynamic_events.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/dynamic_events.tpl.php
index 65f0d78eb0..693072c341 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/dynamic_events.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/dynamic_events.tpl.php
@@ -13,7 +13,7 @@
         var from = e.relatedTarget || e.toElement;
         if (!from || from.nodeName == "HTML") {                
             lh_inst.stopCheckNewMessage();
-            lh_inst.showStartWindow('current_value?>///(inv)/id?>/(vid)/invitation_assigned == true ? print '/(playsound)/true' : ''?>/(fullheight)/',true);
+            lh_inst.showStartWindow('/(inv)/id?>/(vid)/invitation_assigned == true ? print '/(playsound)/true' : ''?>/(fullheight)/',true);
             lh_inst.removeEvent(document,"mouseout",lh_inst.outWindowCallback);
         }
     }
@@ -36,7 +36,7 @@
         clearTimeout(_that.iddleTimeoutActivity); 
         
         lh_inst.stopCheckNewMessage();
-        lh_inst.showStartWindow('current_value?>///(inv)/id?>/(vid)/invitation_assigned == true ? print '/(playsound)/true' : ''?>/(fullheight)/',true);
+        lh_inst.showStartWindow('/(inv)/id?>/(vid)/invitation_assigned == true ? print '/(playsound)/true' : ''?>/(fullheight)/',true);
  
         ['mousemove','mousedown','click','scroll','keypress','load'].forEach(function(element) {
             lh_inst.removeEvent(window,element,lh_inst.resetTimeoutIddle);   
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/part/show_survey.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/part/show_survey.tpl.php
index ece210a69b..d53dd0812f 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/part/show_survey.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/part/show_survey.tpl.php
@@ -2,6 +2,6 @@
     if (lh_inst.cookieData.hash && lh_inst.hasSurvey == true && lh_inst.surveyShown == false){

         var locationCurrent = encodeURIComponent(window.location.href.substring(window.location.protocol.length));

         this.surveyShown = true;

-        document.getElementById('_iframe').contentWindow.location.replace("current_value?>//"+this.lang+"/survey/fillwidgetid : ''?>"+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments()+'&dt='+encodeURIComponent(document.title));

+        document.getElementById('_iframe').contentWindow.location.replace(""+this.lang+"/survey/fillwidgetid : ''?>"+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments()+'&dt='+encodeURIComponent(document.title));

     }

 },
\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/part/show_survey_page.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/part/show_survey_page.tpl.php
index d7c014a77c..e4ff2ef688 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/part/show_survey_page.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/part/show_survey_page.tpl.php
@@ -2,6 +2,6 @@
     if (this.cookieData.hash && this.hasSurvey == true && this.surveyShown == false){
         var locationCurrent = encodeURIComponent(window.location.href.substring(window.location.protocol.length));
         this.surveyShown = true;
-        document.getElementById('_iframe_page').contentWindow.location.replace("current_value?>//"+this.lang+"/survey/fillwidget/(mode)/embedid : ''?>"+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments()+'&dt='+encodeURIComponent(document.title));
+        document.getElementById('_iframe_page').contentWindow.location.replace(""+this.lang+"/survey/fillwidget/(mode)/embedid : ''?>"+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments()+'&dt='+encodeURIComponent(document.title));
     }
 },
\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/send_notification.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/send_notification.tpl.php
index 425fd88231..60044bc475 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/send_notification.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/send_notification.tpl.php
@@ -76,7 +76,7 @@ function updateSubscriptionOnServer(subscription, subscribe) {
         });

 

         var xhr = new XMLHttpRequest();

-        xhr.open( "POST", 'current_value?>//'+that.lang+'/notifications/subscribeid : $theme) : ''?>' + (subscribe == true ? '/(action)/sub' : '/(action)/unsub') + that.getAppendCookieArguments(), true);

+        xhr.open( "POST", ''+that.lang+'/notifications/subscribeid : $theme) : ''?>' + (subscribe == true ? '/(action)/sub' : '/(action)/unsub') + that.getAppendCookieArguments(), true);

         xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

         xhr.send( "data=" + encodeURIComponent( payload ) );

     }

@@ -142,6 +142,6 @@ function initializeUI() {
 readNotification : function(chat_id, hash) {

     data_value;?>

     

-        this.showStartWindow("current_value?>//"+this.lang+"/notifications/read/id : $theme) : ''?>/(id)/"+chat_id+"/(hashread)/"+hash+"/(mode)/widget");

+        this.showStartWindow(""+this.lang+"/notifications/read/id : $theme) : ''?>/(id)/"+chat_id+"/(hashread)/"+hash+"/(mode)/widget");

     

 },

diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/show_start_window.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/show_start_window.tpl.php
index 3df473ee66..8a45f13218 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/show_start_window.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/show_start_window.tpl.php
@@ -13,7 +13,7 @@
         widgetHeightUnit = '%';
     }
 
-    this.initial_iframe_url = "current_value?>//"+this.lang+"/chat/chatwidgetid : ''?>"+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments()+'&dt='+encodeURIComponent(document.title);
+    this.initial_iframe_url = ""+this.lang+"/chat/chatwidgetid : ''?>"+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments()+'&dt='+encodeURIComponent(document.title);
 
     this.iframePreloaded = true;
 
@@ -77,7 +77,7 @@
             this.iframeCustomUrl = true;
       } else {
       		this.chatOpenedCallback(this.isOnline == false ? 'internal_offline' : 'internal');	
-            this.initial_iframe_url = "current_value?>//"+this.lang+"/chat/chatwidgetid : ''?>"+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments()+'&dt='+encodeURIComponent(document.title);
+            this.initial_iframe_url = ""+this.lang+"/chat/chatwidgetid : ''?>"+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments()+'&dt='+encodeURIComponent(document.title);
       };
        
       this.addClass(document.body,'-opened');
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/show_status_widget.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/show_status_widget.tpl.php
index 936694602e..f0f552a784 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/show_status_widget.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/functions/show_status_widget.tpl.php
@@ -17,7 +17,7 @@
       	    'offline_image_url' => ($theme !== false && $theme->offline_image_url !== false && strpos($theme->offline_image_url, 'http') !== false)
       	);          	          	
       	?>
-    	var raw_css = "#_status_container.hide-status,#_status_container.hide-status-delay{display:none!important;}#_status_container * {direction:getOverrideValue('site','dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site','dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;box-sizing: content-box;zoom:1;margin:0;padding:0}\n#_status_container .status-icon{text-decoration:none;font-size:12px;font-weight:bold;color:text_color : print '#000' ?>;display:block;padding:;background:url('online_image_url !== false) : print $theme->online_image_url; else : ?>current_value?>//') no-repeat  center}\n#_status_container:hover{}\n#_status_container #offline-icon{background-image:url('offline_image_url !== false) : print $theme->offline_image_url; else : ?>current_value?>//')}\n#_status_container{box-sizing: content-box;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);;-moz-box-shadow: rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);padding:5px 0px 0px 5px;width:190px;font-family:arial;font-size:12px;transition: 1s;position:fixed;;background-color:#onl_bcolor : print 'f6f6f6' ?>;z-index:2147483647;}@media only screen and (max-width : 640px) {#_need_help_container{display:none;}#_status_container .status-icon{padding:32px 15px 9px 31px;background-position:center center;}#_status_container .-text-status{display:none} #_status_container{}}\n";
+    	var raw_css = "#_status_container.hide-status,#_status_container.hide-status-delay{display:none!important;}#_status_container * {direction:getOverrideValue('site','dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site','dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;box-sizing: content-box;zoom:1;margin:0;padding:0}\n#_status_container .status-icon{text-decoration:none;font-size:12px;font-weight:bold;color:text_color : print '#000' ?>;display:block;padding:;background:url('online_image_url !== false) : print $theme->online_image_url; else : ?>') no-repeat  center}\n#_status_container:hover{}\n#_status_container #offline-icon{background-image:url('offline_image_url !== false) : print $theme->offline_image_url; else : ?>')}\n#_status_container{box-sizing: content-box;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);;-moz-box-shadow: rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);padding:5px 0px 0px 5px;width:190px;font-family:arial;font-size:12px;transition: 1s;position:fixed;;background-color:#onl_bcolor : print 'f6f6f6' ?>;z-index:2147483647;}@media only screen and (max-width : 640px) {#_need_help_container{display:none;}#_status_container .status-icon{padding:32px 15px 9px 31px;background-position:center center;}#_status_container .-text-status{display:none} #_status_container{}}\n";
     	this.addCss(raw_csscustom_status_css_front !== '') ? print '+\''.str_replace(array("\n","\r","'"), array('','','\\\''), $theme->custom_status_css_front).'\'' : '' ?>);
 	};
     
@@ -31,7 +31,7 @@
             'offline_image_url' => ($theme !== false && $theme->offline_image_url !== false && strpos($theme->offline_image_url, 'http') !== false)
         );
         ?>
-        var raw_css = "#_status_container.hide-status,#_status_container.hide-status-delay{display:none!important;}#_status_container * {direction:getOverrideValue('site','dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site','dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;box-sizing: content-box;zoom:1;margin:0;padding:0}#_status_container .-invitation-status{display:none;position:absolute;}#_status_container._invitation-mode .-invitation-status{width: 16px;height:16px;padding: 2px;border-radius: 10px;text-align: center;font-weight: bold;color: #FFF;background-color: red;display: inline-block;}\n#_status_container .status-icon{;;-webkit-box-shadow:  rgba(50, 50, 50, 0.5);-moz-box-shadow: rgba(50, 50, 50, 0.5);box-shadow:  rgba(50, 50, 50, 0.5);text-decoration:none;height:41px;width:41px;font-weight:bold;color:text_color : print '#000' ?>;display:block;padding:10px;background:#onl_bcolor : print '0c8fc4' ?> url('online_image_url !== false) : print $theme->online_image_url; else : ?>current_value?>//') no-repeat center center}\n#_status_container:hover{}\n#_status_container #offline-icon{background:#888888 url('offline_image_url !== false) : print $theme->offline_image_url; else : ?>current_value?>//') no-repeat center}\n#_status_container{box-sizing: content-box;padding:5px 0px 0px 5px;font-family:arial;font-size:12px;transition: 1s;position:fixed;;z-index:2147483647;}@media only screen and (max-width : 640px) {#_need_help_container{display:none;}#_status_container .status-icon{background-position:center center;}#_status_container .-text-status{display:none} #_status_container{}}\n";
+        var raw_css = "#_status_container.hide-status,#_status_container.hide-status-delay{display:none!important;}#_status_container * {direction:getOverrideValue('site','dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site','dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;box-sizing: content-box;zoom:1;margin:0;padding:0}#_status_container .-invitation-status{display:none;position:absolute;}#_status_container._invitation-mode .-invitation-status{width: 16px;height:16px;padding: 2px;border-radius: 10px;text-align: center;font-weight: bold;color: #FFF;background-color: red;display: inline-block;}\n#_status_container .status-icon{;;-webkit-box-shadow:  rgba(50, 50, 50, 0.5);-moz-box-shadow: rgba(50, 50, 50, 0.5);box-shadow:  rgba(50, 50, 50, 0.5);text-decoration:none;height:41px;width:41px;font-weight:bold;color:text_color : print '#000' ?>;display:block;padding:10px;background:#onl_bcolor : print '0c8fc4' ?> url('online_image_url !== false) : print $theme->online_image_url; else : ?>') no-repeat center center}\n#_status_container:hover{}\n#_status_container #offline-icon{background:#888888 url('offline_image_url !== false) : print $theme->offline_image_url; else : ?>') no-repeat center}\n#_status_container{box-sizing: content-box;padding:5px 0px 0px 5px;font-family:arial;font-size:12px;transition: 1s;position:fixed;;z-index:2147483647;}@media only screen and (max-width : 640px) {#_need_help_container{display:none;}#_status_container .status-icon{background-position:center center;}#_status_container .-text-status{display:none} #_status_container{}}\n";
         this.addCss(raw_csscustom_status_css_front !== '') ? print '+\''.str_replace(array("\n","\r","'"), array('','','\\\''), $theme->custom_status_css_front).'\'' : '' ?>);
     };
     
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/getstatus_migrate.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/getstatus_migrate.tpl.php
index 176ead2e32..e82fc263ca 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/getstatus_migrate.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/getstatus_migrate.tpl.php
@@ -42,9 +42,9 @@
 SiteAccess != 'site_admin' ?  erLhcoreClassSystem::instance()->SiteAccess . '/' : ''; ?>
 
 var LHC_API = LHC_API||{};
-LHC_API.args = {'lang':'',mode:'',lhc_base_url:'//',domain: lhc_domain, wheight:, wwidth:,pheight:520,pwidth:500,department:[],leaveamessage:true,proactive:false,check_messages:true};
+LHC_API.args = {'lang':'',mode:'',lhc_base_url:'',domain: lhc_domain, wheight:, wwidth:,pheight:520,pwidth:500,department:[],leaveamessage:true,proactive:false,check_messages:true};
 (function() {
 var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
-var date = new Date();po.src = '//?v1'+(""+date.getFullYear() + date.getMonth() + date.getDate());
+var date = new Date();po.src = '?v1'+(""+date.getFullYear() + date.getMonth() + date.getDate());
 var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
 })();
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/native_placement.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/native_placement.tpl.php
index ba3c5d37f1..2de6b1d00b 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/native_placement.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/native_placement.tpl.php
@@ -1 +1 @@
-document.getElementById('_status_container').innerHTML = ''+(this.isOnline == true ? 'online_text !== '') : print htmlspecialchars_decode($theme->online_text,ENT_QUOTES); else : ?>getTranslation('chat/getstatus','Live help is online...')?>' : 'offline_text != '') : print htmlspecialchars_decode($theme->offline_text,ENT_QUOTES); else : ?>getTranslation('chat/getstatus','Live help is offline...')?>')+'';

+document.getElementById('_status_container').innerHTML = ''+(this.isOnline == true ? 'online_text !== '') : print htmlspecialchars_decode($theme->online_text,ENT_QUOTES); else : ?>getTranslation('chat/getstatus','Live help is online...')?>' : 'offline_text != '') : print htmlspecialchars_decode($theme->offline_text,ENT_QUOTES); else : ?>getTranslation('chat/getstatus','Live help is offline...')?>')+'';

diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/we_here_substatus.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/we_here_substatus.tpl.php
index ee11904c79..2b98a94a1b 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/we_here_substatus.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatus/we_here_substatus.tpl.php
@@ -1,7 +1,7 @@
 var titleText = (typeof .opt.nh_title_text != 'undefined') ? .opt.nh_title_text : need_help_header !== '') : print json_encode($theme->need_help_header); else : ?>getTranslation('chat/getstatus','Need help?'),ENT_QUOTES))?>;

 var subTitleText = (typeof .opt.nh_sub_title_text != 'undefined') ? .opt.nh_sub_title_text : need_help_text !== '') : print json_encode($theme->need_help_text); else : ?>getTranslation('chat/getstatus','Our staff are always ready to help'),ENT_QUOTES))?>;

 need_help_image_url !== false && strpos($theme->need_help_image_url, 'http') !== false); ?>

-var imageTooltip = (typeof .opt.nh_image != 'undefined') ? .opt.nh_image : 'need_help_image_url !== false) : print $theme->need_help_image_url; else : ?>current_value?>//';

+var imageTooltip = (typeof .opt.nh_image != 'undefined') ? .opt.nh_image : 'need_help_image_url !== false) : print $theme->need_help_image_url; else : ?>';

 

 subStatus = ''+

 ''+

diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/getstatusembed.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/getstatusembed.tpl.php
index 80c4fac409..8779222f09 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/getstatusembed.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/getstatusembed.tpl.php
@@ -34,7 +34,7 @@
             var th = document.getElementsByTagName('head')[0];
             var s = document.createElement('script');
             s.setAttribute('type','text/javascript');
-            s.setAttribute('src','current_value?>///(eclose)/t'+this.getAppendCookieArguments());
+            s.setAttribute('src','/(eclose)/t'+this.getAppendCookieArguments());
             th.appendChild(s);
             s.onreadystatechange = s.onload = function(){
                 lh_inst_page.removeCookieAttr('hash');
@@ -178,7 +178,7 @@
         if ( url_to_open != undefined ) {
             this.initial_iframe_url = url_to_open+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+'&dt='+encodeURIComponent(document.title)+this.parseStorageArguments();
         } else {
-            this.initial_iframe_url = "current_value?>///(mode)/embed" + (mobileFullHeight === false ? '/(mobile)/false' : '') + this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments();
+            this.initial_iframe_url = "/(mode)/embed" + (mobileFullHeight === false ? '/(mobile)/false' : '') + this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.parseOptions()+this.parseStorageArguments();
         };
 
         if (mobileFullHeight === true) {
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/lists/op_msg_row_nick.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/lists/op_msg_row_nick.tpl.php
index adb355de45..6672a24119 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/lists/op_msg_row_nick.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/lists/op_msg_row_nick.tpl.php
@@ -10,7 +10,7 @@
             bot->has_photo) : ?>
             

-            
+            


 0 && isset($theme) && $theme !== false && isset($theme->bot_configuration_array['bubble_style_profile']) && $theme->bot_configuration_array['bubble_style_profile'] == 1 &&
@@ -20,7 +20,7 @@
                 has_photo) : ?>
                     

-                    
+                    


bot_configuration_array['bubble_style_profile']) && $theme->bot_configuration_array['bubble_style_profile'] == 1 && $theme->operator_image_avatar !== false) : ?>
@@ -28,7 +28,7 @@
             operator_image_url !== false) : ?>
                 

-                
+                



diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/part/operator_profile_name_support_img.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/part/operator_profile_name_support_img.tpl.php
index 761b6ba316..39fdf11cf4 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/part/operator_profile_name_support_img.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/part/operator_profile_name_support_img.tpl.php
@@ -1,5 +1,5 @@
 has_photo) : ?>
 

-
+

diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/part/operator_profile_start_chat.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/part/operator_profile_start_chat.tpl.php
index d411408d71..1aaeb95c59 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/part/operator_profile_start_chat.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/part/operator_profile_start_chat.tpl.php
@@ -5,7 +5,7 @@
         operator_image_url !== false) : ?>

      			


-                

+                



diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/chatbox.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/chatbox.tpl.php
index 5cec8b8a56..5f3e0f0d94 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/chatbox.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/chatbox.tpl.php
@@ -1 +1 @@
-show_copyright == 1) : ?>
\ No newline at end of file
+show_copyright == 1) : ?>
\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/faq.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/faq.tpl.php
index b0e2ddb4ac..45251f9cec 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/faq.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/faq.tpl.php
@@ -1 +1 @@
-show_copyright == 1) : ?>
\ No newline at end of file
+show_copyright == 1) : ?>
\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/live_help.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/live_help.tpl.php
index a578516905..be4ea49a29 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/live_help.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/live_help.tpl.php
@@ -1,2 +1,2 @@
 copyright_image_url !== false && strpos($theme->copyright_image_url, 'http') !== false);          	          	

-if ($theme === false || $theme->show_copyright == 1) : ?>
\ No newline at end of file
+if ($theme === false || $theme->show_copyright == 1) : ?>
\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/questionary.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/questionary.tpl.php
index 3a231274a3..8991d3263c 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/questionary.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/widget_brand/questionary.tpl.php
@@ -1 +1 @@
-show_copyright == 1) : ?>
\ No newline at end of file
+show_copyright == 1) : ?>
\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhchatbox/embed.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchatbox/embed.tpl.php
index 6da586d12c..d101643418 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchatbox/embed.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchatbox/embed.tpl.php
@@ -9,7 +9,7 @@
 
 	showVotingForm : function() {
 		  var locationCurrent = encodeURIComponent(window.location.href.substring(window.location.protocol.length));
-   		  this.initial_iframe_url = "current_value?>///(chat_height)//(mode)/embed/(identifier)/"+.identifier+'/(hashchatbox)/'+.hashchatbox+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.getAppendRequestArguments();
+   		  this.initial_iframe_url = "/(chat_height)//(mode)/embed/(identifier)/"+.identifier+'/(hashchatbox)/'+.hashchatbox+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.getAppendRequestArguments();
 
    		  this.iframe_html = ' = {hashchatbox:'empty',identifier:'default'};\n"+
       '(function() {'+"\n"+
         'var po = document.createElement(\'script\'); po.type = \'text/javascript\'; po.async = true;'+"\n"+
-        'po.src = \''+$('#HttpMode').val()+'//'+siteAccess+'chatbox/embed'+chat_height+id_theme+"';\n"+
+        'po.src = \''+$('#HttpMode').val()+'//'+siteAccess+'chatbox/embed'+chat_height+id_theme+"';\n"+
         'var s = document.getElementsByTagName(\'script\')[0]; s.parentNode.insertBefore(po, s);'+"\n"+
       '})();'+"\n"+
     '';
diff --git a/lhc_web/design/defaulttheme/tpl/lhchatbox/getstatus.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchatbox/getstatus.tpl.php
index 7e890167c2..bf9ad86866 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchatbox/getstatus.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchatbox/getstatus.tpl.php
@@ -194,7 +194,7 @@
     	var th = document.getElementsByTagName('head')[0];
         var s = document.createElement('script');
         s.setAttribute('type','text/javascript');
-        s.setAttribute('src','current_value?>//');
+        s.setAttribute('src','');
         th.appendChild(s);
         this.removeById('lhc_container_chatbox');
         this.removeCookieAttr('pos');
@@ -243,7 +243,7 @@
    		  this.removeById('lhc_container_chatbox');
 		  var locationCurrent = encodeURIComponent(window.location.href.substring(window.location.protocol.length));
 		  
-   		  this.initial_iframe_url = "current_value?>///(chat_height)/id : ''?>/(identifier)/"+.identifier+'/(hashchatbox)/'+.hashchatbox+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.getAppendRequestArguments();
+   		  this.initial_iframe_url = "/(chat_height)/id : ''?>/(identifier)/"+.identifier+'/(hashchatbox)/'+.hashchatbox+this.getAppendCookieArguments()+'?URLReferer='+locationCurrent+this.getAppendRequestArguments();
 
    		  if (window.innerWidth < 1024) {
           		window.open(this.initial_iframe_url,"_blank");
@@ -259,10 +259,10 @@
                        ' style="width: px; height: px;">';
 
           this.iframe_html = '' +
-                              '' +
+                              '' +
                               this.iframe_html + '';
 
-          raw_css = ".lhc-no-transition{ -webkit-transition: none !important; -moz-transition: none !important;-o-transition: none !important;-ms-transition: none !important;transition: none !important;}\n.lhc-min{height:35px !important}\n#lhc_container_chatbox * {direction:getOverrideValue('site', 'dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial\;font-size:12px\;line-height:100%\;box-sizing: content-box\;-moz-box-sizing:content-box;padding:0;margin:0;}\n#lhc_container_chatbox img {border:0;}\n#lhc_chatbox_title{float:left;}\n#lhc_chatbox_header{position:relative;z-index:9990;height:header_height > 0) ? print $theme->header_height : print '15' ?>px;overflow:hidden;background-color:#header_background : print '525252' ?>;text-align:right;clear:both;padding:header_padding > 0) ? print $theme->header_padding : print '5' ?>px;}\n#lhc_chatbox_close,#lhc_chatbox_min{padding:2px;float:right;}.lhc-min #lhc_chatbox_min{background-image:url(current_value?>//restore_image_url != '') : ?>restore_image_url;?>)}#lhc_chatbox_min{width:14px;height:14px;background:url(minimize_image_url != '') : ?>minimize_image_url;?>current_value?>//) no-repeat center center;}\n\n#lhc_chatbox_close:hover,#lhc_chatbox_min:hover{opacity:0.4}\n#lhc_container_chatbox {overflow: hidden;transition-property: height;transition-duration: 0.4s;-webkit-transition: height 0.4s ease-in-out;transition: height 0.4s;background-color:#FFF\;\nz-index:9990;\n position: fixed;;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);-moz-box-shadow:  rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px;-moz-user-select:none; -khtml-user-drag:element;cursor: move;cursor: -moz-grab;cursor: -webkit-grab; }\n#lhc_container_chatbox iframe{position:relative;display:block;transition-property: height;transition-duration: 0.4s;-webkit-transition: height 0.4s ease-in-out;transition: height 0.4s;}\n#lhc_container_chatbox iframe.lhc-loading{\nbackground: #FFF url(current_value?>//) no-repeat center center; }\n#lhc_container_chatbox #lhc_iframe_container{border:widget_border_width > 0) ? print $theme->widget_border_width : print '1' ?>px solid #widget_border_color : print 'cccccc' ?>;border-top: 0;border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;overflow: hidden;}\n@media only screen and (max-width : 640px) {#lhc_container_chatbox{margin-bottom:5px;position:relative;right:0 !important;bottom:0 !important;top:0 !important}#lhc_container_chatbox iframe{width:100% !important}}";
+          raw_css = ".lhc-no-transition{ -webkit-transition: none !important; -moz-transition: none !important;-o-transition: none !important;-ms-transition: none !important;transition: none !important;}\n.lhc-min{height:35px !important}\n#lhc_container_chatbox * {direction:getOverrideValue('site', 'dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial\;font-size:12px\;line-height:100%\;box-sizing: content-box\;-moz-box-sizing:content-box;padding:0;margin:0;}\n#lhc_container_chatbox img {border:0;}\n#lhc_chatbox_title{float:left;}\n#lhc_chatbox_header{position:relative;z-index:9990;height:header_height > 0) ? print $theme->header_height : print '15' ?>px;overflow:hidden;background-color:#header_background : print '525252' ?>;text-align:right;clear:both;padding:header_padding > 0) ? print $theme->header_padding : print '5' ?>px;}\n#lhc_chatbox_close,#lhc_chatbox_min{padding:2px;float:right;}.lhc-min #lhc_chatbox_min{background-image:url(restore_image_url != '') : ?>restore_image_url;?>)}#lhc_chatbox_min{width:14px;height:14px;background:url(minimize_image_url != '') : ?>minimize_image_url;?>) no-repeat center center;}\n\n#lhc_chatbox_close:hover,#lhc_chatbox_min:hover{opacity:0.4}\n#lhc_container_chatbox {overflow: hidden;transition-property: height;transition-duration: 0.4s;-webkit-transition: height 0.4s ease-in-out;transition: height 0.4s;background-color:#FFF\;\nz-index:9990;\n position: fixed;;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);-moz-box-shadow:  rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);-webkit-border-radius: 5px;-moz-border-radius: 5px;border-radius: 5px;-moz-user-select:none; -khtml-user-drag:element;cursor: move;cursor: -moz-grab;cursor: -webkit-grab; }\n#lhc_container_chatbox iframe{position:relative;display:block;transition-property: height;transition-duration: 0.4s;-webkit-transition: height 0.4s ease-in-out;transition: height 0.4s;}\n#lhc_container_chatbox iframe.lhc-loading{\nbackground: #FFF url() no-repeat center center; }\n#lhc_container_chatbox #lhc_iframe_container{border:widget_border_width > 0) ? print $theme->widget_border_width : print '1' ?>px solid #widget_border_color : print 'cccccc' ?>;border-top: 0;border-bottom-left-radius: 5px;border-bottom-right-radius: 5px;overflow: hidden;}\n@media only screen and (max-width : 640px) {#lhc_container_chatbox{margin-bottom:5px;position:relative;right:0 !important;bottom:0 !important;top:0 !important}#lhc_container_chatbox iframe{width:100% !important}}";
 
           if (!this.cssWasAdded) {
           		this.cssWasAdded = true;
@@ -293,7 +293,7 @@
    showStatusWidget : function() {
    		
        var statusTEXT = ''+.status_text+'';
-       var raw_css = "#lhc_chatbox_container * {direction:getOverrideValue('site', 'dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;line-height:100%;box-sizing: content-box;zoom:1;margin:0;padding:0}\n#lhc_chatbox_container .status-icon{text-decoration:none;font-size:12px;font-weight:bold;color:#text_color : print '000' ?>;display:block;padding:;background:url('current_value?>//') no-repeat  center}\n#lhc_chatbox_container:hover{}\n#lhc_chatbox_container{box-sizing: content-box;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);-moz-box-shadow:  rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);;padding:5px 0px 3px 5px;width:190px;font-family:arial;font-size:12px;line-height:100%;transition: 1s;position:fixed;;background-color:#onl_bcolor : print 'f6f6f6' ?>;z-index:9989;}\n@media only screen and (max-width : 640px) {#lhc_chatbox_container{position:relative;top:0;right:0;bottom:0;left:0;width:auto;border-radius:2px;box-shadow:none;border:1px solid #e3e3e3;margin-bottom:5px;}}\n";
+       var raw_css = "#lhc_chatbox_container * {direction:getOverrideValue('site', 'dir_language') == 'ltr' || erConfigClassLhConfig::getInstance()->getOverrideValue('site', 'dir_language') == '') ? print 'ltr;text-align:left;' : print 'rtl;text-align:right;'; ?>;font-family:arial;font-size:12px;line-height:100%;box-sizing: content-box;zoom:1;margin:0;padding:0}\n#lhc_chatbox_container .status-icon{text-decoration:none;font-size:12px;font-weight:bold;color:#text_color : print '000' ?>;display:block;padding:;background:url('') no-repeat  center}\n#lhc_chatbox_container:hover{}\n#lhc_chatbox_container{box-sizing: content-box;-webkit-box-shadow:  rgba(50, 50, 50, 0.17);-moz-box-shadow:  rgba(50, 50, 50, 0.17);box-shadow:  rgba(50, 50, 50, 0.17);;padding:5px 0px 3px 5px;width:190px;font-family:arial;font-size:12px;line-height:100%;transition: 1s;position:fixed;;background-color:#onl_bcolor : print 'f6f6f6' ?>;z-index:9989;}\n@media only screen and (max-width : 640px) {#lhc_chatbox_container{position:relative;top:0;right:0;bottom:0;left:0;width:auto;border-radius:2px;box-shadow:none;border:1px solid #e3e3e3;margin-bottom:5px;}}\n";
        this.addCss(raw_csscustom_status_css !== '') ? print '+\''.str_replace(array("\n","\r"), '', $theme->custom_status_css).'\'' : '' ?>);
        var htmlStatus = ''+statusTEXT+'';
        var fragment = this.appendHTML(htmlStatus);
diff --git a/lhc_web/design/defaulttheme/tpl/lhchatbox/htmlcode.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchatbox/htmlcode.tpl.php
index 8ad394f312..5e09e5a6bb 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchatbox/htmlcode.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchatbox/htmlcode.tpl.php
@@ -126,7 +126,7 @@ function generateEmbedCode(){
     var script = '')?>
+')?>
')?>
+')?>

+    



diff --git a/lhc_web/modules/lhxmp/configuration.php b/lhc_web/modules/lhxmp/configuration.php
index cd340bb96d..d28c956d35 100644
--- a/lhc_web/modules/lhxmp/configuration.php
+++ b/lhc_web/modules/lhxmp/configuration.php
@@ -61,7 +61,7 @@
 	$client->setClientSecret($data['gtalk_client_secret']);

 	$client->setApprovalPrompt('force');

 	$client->setAccessType('offline');

-	$client->setRedirectUri(erLhcoreClassXMP::getBaseHost().$_SERVER['HTTP_HOST'] . erLhcoreClassDesign::baseurl('xmp/configuration').'/(gtalkoauth)/true');

+	$client->setRedirectUri(erLhcoreClassSystem::getHost() . erLhcoreClassDesign::baseurl('xmp/configuration').'/(gtalkoauth)/true');

 		

 	if (isset($_GET['code'])) {

 		try {			

@@ -168,7 +168,7 @@
 		$client->setClientSecret($data['gtalk_client_secret']);

 		$client->setApprovalPrompt('force');

 		$client->setAccessType('offline');

-		$client->setRedirectUri(erLhcoreClassXMP::getBaseHost().$_SERVER['HTTP_HOST'] . erLhcoreClassDesign::baseurl('xmp/configuration').'/(gtalkoauth)/true');

+		$client->setRedirectUri(erLhcoreClassSystem::getHost() . erLhcoreClassDesign::baseurl('xmp/configuration').'/(gtalkoauth)/true');

 			

 		if ( !$client->getAccessToken() ) {

 			header('Location: '.$client->createAuthUrl());

@@ -176,7 +176,7 @@
 		}

 	}

 	

-	$tpl->set('updated','done');	

+	$tpl->set('updated','done');

 }

 

 

diff --git a/lhc_web/settings/settings.ini.default.php b/lhc_web/settings/settings.ini.default.php
index 8b2d3cbc4e..a44d2e1a14 100644
--- a/lhc_web/settings/settings.ini.default.php
+++ b/lhc_web/settings/settings.ini.default.php
@@ -26,6 +26,9 @@
                     'maps_api_key' => false,
                     'default_group' => '',
                     'default_user' => '',
+                    'site_address' => '',
+                    'trusted_host_patterns' => [
+                    ],
                     'extensions' =>
                         array (
                             // 0 => 'customstatus',
