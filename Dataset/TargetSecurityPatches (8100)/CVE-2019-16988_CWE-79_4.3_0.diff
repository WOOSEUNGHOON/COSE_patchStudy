7fec1014ff0d08e36be6a3f7664edb3a9df7b4ac
fusionpbx@@fusionpbx
diff --git a/app/basic_operator_panel/resources/content.php b/app/basic_operator_panel/resources/content.php
index 72797b92f2..f327d60ae4 100644
--- a/app/basic_operator_panel/resources/content.php
+++ b/app/basic_operator_panel/resources/content.php
@@ -114,30 +114,30 @@
 if (permission_exists('operator_panel_eavesdrop')) {
 	echo "				";
 	if (sizeof($_SESSION['user']['extensions']) > 1) {
-		echo "				";
+		echo "				";
 		echo "				";
 		echo "				\n";
 		if (is_array($_SESSION['user']['extensions'])) foreach ($_SESSION['user']['extensions'] as $user_extension) {
-			echo "				".$user_extension."\n";
+			echo "				".escape($user_extension)."\n";
 		}
 		echo "				\n";
 	}
 	else if (sizeof($_SESSION['user']['extensions']) == 1) {
-		echo "				";
+		echo "				";
 	}
 	echo "				";
 }
 
 if (sizeof($groups) > 0) {
 	echo "				";
-	echo "					";
+	echo "					";
 	if (sizeof($groups) > 5) {
 		//show select box
 		echo "				\n";
 		echo "					".$text['label-call_group']."";
 		echo "					".$text['button-all']."";
 		if (is_array($groups)) foreach ($groups as $group) {
-			echo "				".$group."\n";
+			echo "				".escape($group)."\n";
 		}
 		echo "				\n";
 	}
@@ -145,7 +145,7 @@
 		//show buttons
 		echo "				";
 		if (is_array($groups)) foreach ($groups as $group) {
-			echo "			";
+			echo "			";
 		}
 	}
 	echo "				";
@@ -309,12 +309,12 @@
 			$status_hover = $text['label-status_logged_out_or_unknown'];
 	}
 
-	$block .= ""; // DRAG TO
+	$block .= ""; // DRAG TO
 	$block .= "";
 	$block .= "	";
 	$block .= "		";
-	$block .= "			"; // DRAG FROM
-	$block .= 				"";
+	$block .= "			"; // DRAG FROM
+	$block .= 				"";
 	$block .= 			"";
 	$block .= "		";
 	$block .= "		";
@@ -322,22 +322,22 @@
 		$block .= "			";
 	}
 	$block .= "			";
-	if ($ext['effective_caller_id_name'] != '' && $ext['effective_caller_id_name'] != $extension) {
-		$block .= "			".$ext['effective_caller_id_name']." (".$extension.")";
+	if ($ext['effective_caller_id_name'] != '' && escape($ext['effective_caller_id_name']) != $extension) {
+		$block .= "			".escape($ext['effective_caller_id_name'])." (".escape($extension).")";
 	}
 	else {
-		$block .= "			".$extension."";
+		$block .= "			".escape($extension)."";
 	}
 	$block .= "			";
 	if ($ext_state != '') {
 		$block .= "		";
 		$block .= "			";
-		$block .= "				".$ext['call_length']."";
+		$block .= "				".escape($ext['call_length'])."";
 		$block .= "				";
 		//record
 		if (permission_exists('operator_panel_record') && $ext_state == 'active') {
 			$call_identifier_record = $ext['call_uuid'];
-			$rec_file = $_SESSION['switch']['recordings']['dir']."/archive/".date("Y")."/".date("M")."/".date("d")."/".$call_identifier_record.".wav";
+			$rec_file = $_SESSION['switch']['recordings']['dir']."/archive/".date("Y")."/".date("M")."/".date("d")."/".escape($call_identifier_record).".wav";
 			if (file_exists($rec_file)) {
 				$block .= 		"";
 			}
@@ -347,7 +347,7 @@
 		}
 		//eavesdrop
 		if (permission_exists('operator_panel_eavesdrop') && $ext_state == 'active' && sizeof($_SESSION['user']['extensions']) > 0 && !in_array($extension, $_SESSION['user']['extensions'])) {
-			$block .= 			"";
+			$block .= 			"";
 		}
 		//hangup
 		if (permission_exists('operator_panel_hangup') || in_array($extension, $_SESSION['user']['extensions'])) {
@@ -360,32 +360,32 @@
 			else {
 				$call_identifier_hangup_uuid = $call_identifier;
 			}
-			$block .= 			"";
+			$block .= 			"";
 		}
 		$block .=				"";
 		//transfer
 		if (in_array($extension, $_SESSION['user']['extensions']) && $ext_state == 'active') {
-			$block .= 			"";
+			$block .= 			"";
 		}
 		$block .= "			";
 		if (permission_exists('operator_panel_call_details')) {
-			$block .= "			".escape($call_name)."".escape($call_number)."";
+			$block .= "			".escape($call_name)."".escape($call_number)."";
 		}
 		$block .= "		";
 		//transfer
 		if (in_array($extension, $_SESSION['user']['extensions']) && $ext_state == 'active') {
 			$call_identifier_transfer = $ext['variable_bridge_uuid'];
-			$block .= "		";
-			$block .= "			";
+			$block .= "		";
+			$block .= "			";
 			$block .= "		\n";
 		}
 	}
 	else {
 		//call
 		if (in_array($extension, $_SESSION['user']['extensions'])) {
-			$block .= "		";
-			$block .= "		";
-			$block .= "			";
+			$block .= "		";
+			$block .= "		";
+			$block .= "			";
 			$block .= "		\n";
 		}
 	}
@@ -395,18 +395,18 @@
 
 	if (if_group("superadmin") && isset($_GET['debug'])) {
 		$block .= "";
-		$block .= "From ID    ".$extension."";
-		$block .= "uuid    ".$ext['uuid']."";
-		$block .= "call_uuid    ".$ext['call_uuid']."";
-		$block .= "variable_bridge_uuid    ".$ext['variable_bridge_uuid']."";
-		$block .= "direction    ".$ext['direction']."";
-		$block .= "variable_call_direction    ".$ext['variable_call_direction']."";
-		$block .= "state    ".$ext['state']."";
-		$block .= "cid_num    ".$ext['cid_num']."";
-		$block .= "dest    ".$ext['dest']."";
-		$block .= "context    ".$ext['context']."";
-		$block .= "presence_id    ".$ext['presence_id']."";
-		$block .= "callstate    ".$ext['callstate']."";
+		$block .= "From ID    ".escape($extension)."";
+		$block .= "uuid    ".escape($ext['uuid'])."";
+		$block .= "call_uuid    ".escape($ext['call_uuid'])."";
+		$block .= "variable_bridge_uuid    ".escape($ext['variable_bridge_uuid'])."";
+		$block .= "direction    ".escape($ext['direction'])."";
+		$block .= "variable_call_direction    ".escape($ext['variable_call_direction'])."";
+		$block .= "state    ".escape($ext['state'])."";
+		$block .= "cid_num    ".escape($ext['cid_num'])."";
+		$block .= "dest    ".escape($ext['dest'])."";
+		$block .= "context    ".escape($ext['context'])."";
+		$block .= "presence_id    ".escape($ext['presence_id'])."";
+		$block .= "callstate    ".escape($ext['callstate'])."";
 		$block .= "";
 	}
 	$block .= "";
@@ -430,7 +430,7 @@
 
 if ($_REQUEST['group'] != '') {
 	if (sizeof($user_extensions) > 0) { echo ""; }
-	echo "".ucwords($_REQUEST['group'])."";
+	echo "".ucwords(escape($_REQUEST['group']))."";
 	echo "";
 }
 else if (sizeof($user_extensions) > 0) {
