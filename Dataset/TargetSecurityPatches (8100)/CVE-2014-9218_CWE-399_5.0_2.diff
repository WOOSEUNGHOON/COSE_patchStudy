095729d81205f15f40d216d25917017da4c2fff8
phpmyadmin@@phpmyadmin
diff --git a/ChangeLog b/ChangeLog
index c0e57bef9fc..0a9f46ccc8e 100644
--- a/ChangeLog
+++ b/ChangeLog
@@ -1,6 +1,9 @@
 phpMyAdmin - ChangeLog
 ======================
 
+4.0.10.7 (not yet released)
+- bug #4611 [security] DOS attack with long passwords
+
 4.0.10.6 (2014-11-20)
 - bug #4578 [security] XSS vulnerability in table print view
 - bug #4579 [security] XSS vulnerability in zoom search page
diff --git a/libraries/common.inc.php b/libraries/common.inc.php
index 46d8eb107ac..e1042c4aa02 100644
--- a/libraries/common.inc.php
+++ b/libraries/common.inc.php
@@ -866,6 +866,9 @@
                 . ' ' . $cfg['Server']['auth_type']
             );
         }
+        if (isset($_REQUEST['pma_password'])) {
+            $_REQUEST['pma_password'] = substr($_REQUEST['pma_password'], 0, 256);
+        }
         include_once  './libraries/plugins/auth/' . $auth_class . '.class.php';
         // todo: add plugin manager
         $plugin_manager = null;
@@ -974,6 +977,8 @@
             $controllink = $userlink;
         }
 
+        $auth_plugin->storeUserCredentials();
+
         /* Log success */
         PMA_log_user($cfg['Server']['user']);
 
diff --git a/libraries/plugins/AuthenticationPlugin.class.php b/libraries/plugins/AuthenticationPlugin.class.php
index 3ddf55ee206..7943d2cb156 100644
--- a/libraries/plugins/AuthenticationPlugin.class.php
+++ b/libraries/plugins/AuthenticationPlugin.class.php
@@ -41,6 +41,15 @@ abstract public function authCheck();
      */
     abstract public function authSetUser();
 
+    /**
+     * Stores user credentials after successful login.
+     *
+     * @return void
+     */
+    public function storeUserCredentials()
+    {
+    }
+
     /**
      * User is not allowed to login to MySQL -> authentication failed
      *
diff --git a/libraries/plugins/auth/AuthenticationCookie.class.php b/libraries/plugins/auth/AuthenticationCookie.class.php
index 72274d9e312..329a030cb68 100644
--- a/libraries/plugins/auth/AuthenticationCookie.class.php
+++ b/libraries/plugins/auth/AuthenticationCookie.class.php
@@ -475,6 +475,16 @@ public function authSetUser()
         unset($_SERVER['PHP_AUTH_PW']);
 
         $_SESSION['last_access_time'] = time();
+    }
+
+    /**
+     * Stores user credentials after successful login.
+     *
+     * @return void
+     */
+    public function storeUserCredentials()
+    {
+        global $cfg;
 
         // Name and password cookies need to be refreshed each time
         // Duration = one month for username
