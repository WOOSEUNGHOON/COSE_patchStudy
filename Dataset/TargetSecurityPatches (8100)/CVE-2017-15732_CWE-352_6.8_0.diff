ec8b3cc37d05b6625e24916b8f7253f830015b5f
thorsten@@phpMyFAQ
diff --git a/phpmyfaq/admin/news.php b/phpmyfaq/admin/news.php
index c204df0f00..1bf0657e71 100644
--- a/phpmyfaq/admin/news.php
+++ b/phpmyfaq/admin/news.php
@@ -29,12 +29,18 @@
 
 $news = new PMF_News($faqConfig);
 
+$csrfToken = PMF_Filter::filterInput(INPUT_POST, 'csrf', FILTER_SANITIZE_STRING);
+if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {
+    $csrfCheck = false;
+} else {
+    $csrfCheck = true;
+}
+
 if ('addnews' == $action && $user->perm->checkRight($user->getUserId(), 'addnews')) {
     ?>
         

-                 
+                 


 
@@ -44,8 +50,7 @@
 
                     

-                            
+                            



@@ -53,8 +58,7 @@
                     

-                        :
+                        :

Please enable JavaScript to use the WYSIWYG editor!

@@ -62,70 +66,59 @@
                     

-                        
+                        


+                                   value="getUserData('display_name') ?>">
                         


-                        
+                        


+                                   value="getUserData('email') ?>">
                         



-                            :
+                            :
                         



-                                
+                                




-                        
+                        



-                                
+                                




-                        
+                        





-                        
+                        





-                        
+                        



@@ -140,16 +133,13 @@
                         


-                        :
+                        :

-                            
+                            


 
-                    
+                    


@@ -594,7 +584,7 @@
             

@@ -602,8 +592,8 @@
         ?>


-    
+    
+    


deleteNews($delete_id);
-        printf('%s', $PMF_LANG['ad_news_delsuc']);
-        printf('→ %s', $PMF_LANG['msgNews']);
+        if ($csrfCheck) {
+            $deleteId = PMF_Filter::filterInput(INPUT_POST, 'id', FILTER_VALIDATE_INT);
+            $news->deleteNews($deleteId);
+            printf('%s', $PMF_LANG['ad_news_delsuc']);
+            printf('→ %s', $PMF_LANG['msgNews']);
+        }
     }
 } else {
     echo $PMF_LANG['err_NotAuth'];
