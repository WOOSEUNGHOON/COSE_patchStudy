0d3181324c816bdf664ca5e1548dfe8eb05c54f8
GPCsolutions@@dolibarr
diff --git a/htdocs/core/lib/functions.lib.php b/htdocs/core/lib/functions.lib.php
index c530f612d29..81412531262 100644
--- a/htdocs/core/lib/functions.lib.php
+++ b/htdocs/core/lib/functions.lib.php
@@ -1,16 +1,17 @@
 
- * Copyright (C) 2003      Jean-Louis Bergamo   
- * Copyright (C) 2004-2013 Laurent Destailleur  
- * Copyright (C) 2004      Sebastien Di Cintio  
- * Copyright (C) 2004      Benoit Mortier       
- * Copyright (C) 2004      Christophe Combelles 
- * Copyright (C) 2005-2012 Regis Houssin        
- * Copyright (C) 2008      Raphael Bertrand (Resultic)       
- * Copyright (C) 2010-2011 Juanjo Menent        
- * Copyright (C) 2013      Cédric Salvador      
- * Copyright (C) 2013      Alexandre Spangaro   
- * Copyright (C) 2014-2015 Marcos García        
+/* Copyright (C) 2000-2007  Rodolphe Quiedeville        
+ * Copyright (C) 2003       Jean-Louis Bergamo          
+ * Copyright (C) 2004-2013  Laurent Destailleur         
+ * Copyright (C) 2004       Sebastien Di Cintio         
+ * Copyright (C) 2004       Benoit Mortier              
+ * Copyright (C) 2004       Christophe Combelles        
+ * Copyright (C) 2005-2012  Regis Houssin               
+ * Copyright (C) 2008       Raphael Bertrand (Resultic) 
+ * Copyright (C) 2010-2011  Juanjo Menent               
+ * Copyright (C) 2013       Cédric Salvador             
+ * Copyright (C) 2013       Alexandre Spangaro          
+ * Copyright (C) 2014-2015  Marcos García               
+ * Copyright (C) 2016       Raphaël Doursenaud          
  *
  * This program is free software; you can redistribute it and/or modify
  * it under the terms of the GNU General Public License as published by
@@ -194,10 +195,10 @@ function GETPOST($paramname,$check='',$method=0)
 		elseif ($check == 'alpha')
 		{
 			$out=trim($out);
-			// '"' is dangerous because param in url can close the href= or src= and add javascript functions.
 			// '../' is dangerous because it allows dir transversals
-			if (preg_match('/"/',$out)) $out='';
-			else if (preg_match('/\.\.\//',$out)) $out='';
+			if (preg_match('/\.\.\//',$out)) $out='';
+			// Quotes are dangerous because param in url can close the href= or src= and add javascript functions.
+			$out = htmlspecialchars($out, ENT_QUOTES);
 		}
 		elseif ($check == 'aZ')
 		{
