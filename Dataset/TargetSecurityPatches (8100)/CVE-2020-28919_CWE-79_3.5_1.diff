e7fd8e4c90be490e4293ec91804d00ec01af5ca6
tribe29@@checkmk
diff --git a/cmk/gui/escaping.py b/cmk/gui/escaping.py
index 03dcdda9ed..6f7db543e4 100644
--- a/cmk/gui/escaping.py
+++ b/cmk/gui/escaping.py
@@ -7,6 +7,7 @@
 from html import escape as html_escape
 import re
 from typing import Union
+from urllib.parse import urlparse
 
 from six import ensure_str
 
@@ -113,6 +114,11 @@ def escape_text(text: EscapableEntity) -> str:
     text = _UNESCAPER_TEXT.sub(r'<\1\2>', text)
     for a_href in _A_HREF.finditer(text):
         href = a_href.group(1)
+
+        parsed = urlparse(href)
+        if parsed.scheme != "" and parsed.scheme not in ["http", "https"]:
+            continue  # Do not unescape links containing disallowed URLs
+
         target = a_href.group(2)
 
         if target:
diff --git a/tests/unit/cmk/gui/test_htmllib_Escaper.py b/tests/unit/cmk/gui/test_htmllib_Escaper.py
index 3a34499bad..6a015c8220 100644
--- a/tests/unit/cmk/gui/test_htmllib_Escaper.py
+++ b/tests/unit/cmk/gui/test_htmllib_Escaper.py
@@ -72,8 +72,14 @@ def test_unescape_attribute(inp, out):
             "abc<script>alert(1)</script>abc",
         ),
         ("Â ", None),
-        # At the moment also javascript URLs are accepted. This will be refused in the next step
-        ("abc", None),
+        # Only http/https are allowed as schemes
+        ("abc", None),
+        ("abc", None),
+        ("abc", None),
+        ("abc",
+         "<a href="ftp://checkmk.com/">abc"),
+        ("abc",
+         "<a href="javascript:alert(1)">abc"),
     ])
 def test_escape_text(inp, out):
     if out is None:
