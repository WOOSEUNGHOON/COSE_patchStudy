2f07985bef9fbae124cc63e5c0272e32da4fdaec
facebook@@proxygen
diff --git a/proxygen/lib/http/structuredheaders/StructuredHeadersUtilities.cpp b/proxygen/lib/http/structuredheaders/StructuredHeadersUtilities.cpp
index 9464f3b7c..80b591e5f 100644
--- a/proxygen/lib/http/structuredheaders/StructuredHeadersUtilities.cpp
+++ b/proxygen/lib/http/structuredheaders/StructuredHeadersUtilities.cpp
@@ -9,11 +9,10 @@
  */
 
 #include "StructuredHeadersUtilities.h"
-#include 
-#include 
-#include 
 #include "StructuredHeadersConstants.h"
 
+#include "proxygen/lib/utils/Base64.h"
+
 namespace proxygen {
 namespace StructuredHeaders {
 
@@ -107,31 +106,23 @@ std::string decodeBase64(
 
   if (encoded.size() == 0) {
     // special case, to prevent an integer overflow down below.
-    return "";
+    return std::string();
   }
 
-  using namespace boost::archive::iterators;
-  using b64it =
-    transform_width, 8, 6>;
-
-  std::string decoded = std::string(b64it(std::begin(encoded)),
-                                    b64it(std::end(encoded)));
-
-  uint32_t numPadding = std::count(encoded.begin(), encoded.end(), '=');
-  decoded.erase(decoded.end() - numPadding, decoded.end());
+  int padding = 0;
+  for (auto it = encoded.rbegin();
+       padding < 2 && it != encoded.rend() && *it == '=';
+       ++it) {
+    ++padding;
+  }
 
-  return decoded;
+  return Base64::decode(encoded, padding);
 }
 
 std::string encodeBase64(const std::string& input) {
-  using namespace boost::archive::iterators;
-  using b64it = base64_from_binary>;
-
-  auto data = input.data();
-  std::string encoded(b64it(data), b64it(data + (input.length())));
-  encoded.append((3 - (input.length() % 3)) % 3, '=');
-
-  return encoded;
+  return Base64::encode(folly::ByteRange(
+                            reinterpret_cast(input.c_str()),
+                            input.length()));
 }
 
 }
