698245488343396185b1b49e7482ee5b25541815
semplon@@GeniXCMS
diff --git a/gxadmin/inc/categories.php b/gxadmin/inc/categories.php
index 4f12fd0b..b520411b 100644
--- a/gxadmin/inc/categories.php
+++ b/gxadmin/inc/categories.php
@@ -12,7 +12,35 @@
 * @copyright 2014-2015 Puguh Wijayanto
 * @license http://www.opensource.org/licenses/mit-license.php MIT
 *
-*/?>
+*/
+
+if (isset($data['alertgreen'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    ";
+    foreach ($data['alertgreen'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}
+if (isset($data['alertred'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    ";
+    foreach ($data['alertred'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}
+?>
 

  Categories 
@@ -34,12 +62,12 @@
                         // echo "".$c->parent."";
                         // echo "";
 
-                        if($c->parent == ""){
+                        if($c->parent == "" || $c->parent == 0){
                             echo "


{$c->name} 
-                                  id}\" class=\"pull-right\"
+                                  id}&token=".TOKEN."\" class=\"pull-right\"
                                   onclick=\"return confirm('Are you sure you want to delete this item?');\">
                                   

@@ -48,13 +76,14 @@
                                 foreach ($data['cat'] as $c2) {
                                     if($c2->parent == $c->id){
                                         echo "
-                                        
+                                        

-                                            id}\" class=\"input-group-addon\"
+                                            id}&token=".TOKEN."\" class=\"input-group-addon\"
                                             onclick=\"return confirm('Are you sure you want to delete this item?');\"
                                             >
name}\">
                                             id}\">
+                                            

Go!

@@ -92,7 +121,7 @@
                     Parent
 '',
+                                    'parent' => '0',
                                     'name' => 'parent',
                                     'sort' => 'ASC',
                                     'order_by' => 'name'
@@ -107,6 +136,7 @@
             
           

+            
Close
Save changes

diff --git a/gxadmin/inc/menus.php b/gxadmin/inc/menus.php
index 0339104e..e79aac03 100644
--- a/gxadmin/inc/menus.php
+++ b/gxadmin/inc/menus.php
@@ -12,7 +12,37 @@
 * @copyright 2014-2015 Puguh Wijayanto
 * @license http://www.opensource.org/licenses/mit-license.php MIT
 *
-*/?>
+*/
+
+if (isset($data['alertgreen'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    
+    ";
+    foreach ($data['alertgreen'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}elseif (isset($data['alertred'])) {
+    # code...
+    //print_r($data['alertred']);
+    echo "
+    
+        ×
+        Close
+    
+    ";
+    foreach ($data['alertred'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}
+?>
 

 
@@ -84,7 +114,7 @@
                                           

                                           ";
-                                              $data['parent'] = Menus::getParent('', $k);
+                                              $data['parent'] = Menus::isHadParent('', $k);
                                               //print_r($data['parent']);
                                               $data['menuid'] = $k;
                                               System::inc('menus_form', $data);
@@ -146,6 +176,7 @@
 
           

+            
Close
Save changes

diff --git a/gxadmin/inc/menus_form.php b/gxadmin/inc/menus_form.php
index 970a1dc8..d2db913e 100644
--- a/gxadmin/inc/menus_form.php
+++ b/gxadmin/inc/menus_form.php
@@ -19,6 +19,35 @@
     }else{
         $menuid = $data['menuid'];
     }
+if (isset($data['alertgreen'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    
+    ";
+    foreach ($data['alertgreen'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}elseif (isset($data['alertred'])) {
+    # code...
+    //print_r($data['alertred']);
+    echo "
+    
+        ×
+        Close
+    
+    ";
+    foreach ($data['alertred'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}
+
 ?>
 
 Add Menu
@@ -142,4 +171,5 @@
         


+

\ No newline at end of file
diff --git a/gxadmin/inc/menus_form_edit.php b/gxadmin/inc/menus_form_edit.php
index 8c4ddcb6..d2a6716b 100644
--- a/gxadmin/inc/menus_form_edit.php
+++ b/gxadmin/inc/menus_form_edit.php
@@ -21,12 +21,34 @@
     }
 
     //print_r($data['menus']);
-    if(isset($data['alertgreen']) ) {
-        echo "";
-            foreach ($data['alertgreen'] as $alert) {
-                echo "$alert"; 
-            }
-        echo ""; }
+    if (isset($data['alertgreen'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    
+    ";
+    foreach ($data['alertgreen'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}elseif (isset($data['alertred'])) {
+    # code...
+    //print_r($data['alertred']);
+    echo "
+    
+        ×
+        Close
+    
+    ";
+    foreach ($data['alertred'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}
 ?>
 

@@ -48,11 +70,12 @@
     

Parent Menu
+            
             

parent == $p->id){
@@ -183,5 +206,6 @@
         


+


\ No newline at end of file
diff --git a/gxadmin/inc/pages.php b/gxadmin/inc/pages.php
index 36fde2a7..82319cb0 100644
--- a/gxadmin/inc/pages.php
+++ b/gxadmin/inc/pages.php
@@ -13,32 +13,32 @@
 * @license http://www.opensource.org/licenses/mit-license.php MIT
 *
 */
-    if (isset($data['alertgreen'])) {
+if (isset($data['alertgreen'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    ";
+    foreach ($data['alertgreen'] as $alert) {
         # code...
-        echo "
-        
-            ×
-            Close
-        ";
-        foreach ($data['alertgreen'] as $alert) {
-            # code...
-            echo "$alert\n";
-        }
-        echo "";
+        echo "$alert\n";
     }
-    if (isset($data['alertred'])) {
+    echo "";
+}
+if (isset($data['alertred'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    ";
+    foreach ($data['alertred'] as $alert) {
         # code...
-        echo "
-        
-            ×
-            Close
-        ";
-        foreach ($data['alertred'] as $alert) {
-            # code...
-            echo "$alert\n";
-        }
-        echo "";
+        echo "$alert\n";
     }
+    echo "";
+}
 ?>
 

@@ -46,68 +46,80 @@
         


-        
-            
-                
-                    
-                        ID
-                        Title
-                        Date
-                        Edit/Delete
-                        All 
-                    
-                
-                
-                     0){
-                        foreach ($data['posts'] as $p) {
-                            # code...
-                            //echo $p->id;
+        
+            
+                
+                    
+                        
+                            ID
+                            Title
+                            Date
+                            Status
+                            Edit/Delete
+                            All 
+                        
+                    
+                    
+                         0){
+                            foreach ($data['posts'] as $p) {
+                                # code...
+                                //echo $p->id;
+                                if($p->status == '0'){
+                                    $status = "UnPublished";
+                                }else{
+                                    $status = "Published";
+                                }
+                                echo "
+                                
+                                    {$p->id}
+                                    id)."\" target=\"_new\">{$p->title}
+                                    {$p->date}
+                                    {$status}
+                                    
+                                        id}&token=".TOKEN."\" class=\"label label-success\">Edit 
+                                        id}&token=".TOKEN."\" class=\"label label-danger\" 
+                                        onclick=\"return confirm('Are you sure you want to delete this item?');\">Delete
+                                    
+                                        
+                                        id}\" id=\"select\">
+                                    
+                                
+                                ";
+                            }
+                        }else{
                             echo "
-                            
-                                {$p->id}
-                                id)."\" target=\"_new\">{$p->title}
-                                {$p->date}
-                                
-                                    id}\" class=\"label label-success\">Edit 
-                                    id}\" class=\"label label-danger\" 
-                                    onclick=\"return confirm('Are you sure you want to delete this item?');\">Delete
-                                
+                                

-                                    id}\" id=\"select\">
-                                
-                            
-                            ";
+                                        No Pages Found 
+                                    
+                                ";
                         }
-                    }else{
-                        echo "
-                            
-                                
-                                    No Pages Found 
-                                
-                            ";
-                    }
-                    ?>
-                
-                
-                    ID
-                    Title
-                    Date
-                    
-                    
-                        Publish
-                        UnPublish
-                        Delete
-                    
-                    
-                    
-                        
-                            Submit
-                        
-                    
-                
-            
-        
+                        ?>
+                    
+                    
+                        ID
+                        Title
+                        Date
+                        Status
+                        
+                        
+                            Publish
+                            UnPublish
+                            Delete
+                        
+                        
+                        
+                        
+                            
+                                Submit
+                            
+                        
+                    
+                
+            
+        
+        
     

\ No newline at end of file
diff --git a/gxadmin/inc/pages_form.php b/gxadmin/inc/pages_form.php
index 75b649b6..c07949f7 100644
--- a/gxadmin/inc/pages_form.php
+++ b/gxadmin/inc/pages_form.php
@@ -13,20 +13,39 @@
 * @license http://www.opensource.org/licenses/mit-license.php MIT
 *
 */
-    if (isset($data['alertgreen'])) {
+
+isset($_GET['token'])? $token = $_GET['token']: $token = TOKEN;
+($_GET['act'] == "edit")? $pagetitle = "Edit": $pagetitle = "New";
+($_GET['act'] == "edit")? $act = "edit&id={$_GET['id']}&token={$_GET['token']}": $act = "add";
+
+if (isset($data['alertgreen'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    
+    ";
+    foreach ($data['alertgreen'] as $alert) {
         # code...
-        echo "
-        
-            ×
-            Close
-        
-        ";
-        foreach ($data['alertgreen'] as $alert) {
-            # code...
-            echo "$alert\n";
-        }
-        echo "";
+        echo "$alert\n";
+    }
+    echo "";
+}
+
+if (isset($data['alertred'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    ";
+    foreach ($data['alertred'] as $alert) {
+        # code...
+        echo "$alert\n";
     }
+    echo "";
+}
 
     if(isset($data['post'])) {
         foreach ($data['post'] as $p) {
@@ -54,7 +73,7 @@
         $unpub = "";
     }
 ?>
-
+


 New Page 
@@ -114,5 +133,6 @@
         
     

+

 
diff --git a/gxadmin/inc/posts.php b/gxadmin/inc/posts.php
index 51287dc6..a3d29e02 100644
--- a/gxadmin/inc/posts.php
+++ b/gxadmin/inc/posts.php
@@ -55,6 +55,7 @@
                 Title
Category
Date
+                Status
Edit/Delete
All 

@@ -66,15 +67,21 @@
                     foreach ($data['posts'] as $p) {
                         # code...
                         //echo $p->id;
+                        if($p->status == '0'){
+                            $status = "UnPublished";
+                        }else{
+                            $status = "Published";
+                        }
                         echo "
                         
{$p->id}
id)."\" target=\"_new\">{$p->title}
".Categories::name($p->cat)."
{$p->date}
+                            {$status}

-                                id}\" class=\"label label-success\">Edit 
-                                id}\" class=\"label label-danger\" 
+                                id}&token=".TOKEN."\" class=\"label label-success\">Edit 
+                                id}&token=".TOKEN."\" class=\"label label-danger\" 
                                 onclick=\"return confirm('Are you sure you want to delete this item?');\">Delete


@@ -98,12 +105,14 @@
             Title
Category
Date
+            Status


Publish
UnPublish
Delete

+            



diff --git a/gxadmin/inc/posts_form.php b/gxadmin/inc/posts_form.php
index b8a7e31a..c02f862a 100644
--- a/gxadmin/inc/posts_form.php
+++ b/gxadmin/inc/posts_form.php
@@ -13,63 +13,66 @@
 * @license http://www.opensource.org/licenses/mit-license.php MIT
 *
 */
-    if (isset($data['alertgreen'])) {
+isset($_GET['token'])? $token = $_GET['token']: $token = TOKEN;
+($_GET['act'] == "edit")? $pagetitle = "Edit": $pagetitle = "New";
+($_GET['act'] == "edit")? $act = "edit&id={$_GET['id']}&token={$_GET['token']}": $act = "add";
+if (isset($data['alertgreen'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    ";
+    foreach ($data['alertgreen'] as $alert) {
         # code...
-        echo "
-        
-            ×
-            Close
-        ";
-        foreach ($data['alertgreen'] as $alert) {
-            # code...
-            echo "$alert\n";
-        }
-        echo "";
+        echo "$alert\n";
     }
-    if (isset($data['alertred'])) {
+    echo "";
+}
+if (isset($data['alertred'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    ";
+    foreach ($data['alertred'] as $alert) {
         # code...
-        echo "
-        
-            ×
-            Close
-        ";
-        foreach ($data['alertred'] as $alert) {
-            # code...
-            echo "$alert\n";
-        }
-        echo "";
+        echo "$alert\n";
     }
+    echo "";
+}
 
-    if(isset($data['post'])) {
-        foreach ($data['post'] as $p) {
-            # code...
-            $title = $p->title;
-            $content = $p->content;
-            $date = $p->date;
-            $status = $p->status;
-            $cat = $p->cat;
-        }
-        if($status == 1) {
-            $pub = "SELECTED"; 
-            $unpub = ""; 
-        }elseif ($status == 0) {
-            $pub = ""; 
-            $unpub = "SELECTED";
-        }
-    }else{
-        $title = "";
-        $content = "";
-        $date = "";
-        $status = "";
-        $cat = "";
-        $pub = "";
-        $unpub = "";
+if(isset($data['post'])) {
+    foreach ($data['post'] as $p) {
+        # code...
+        $title = $p->title;
+        $content = $p->content;
+        $date = $p->date;
+        $status = $p->status;
+        $cat = $p->cat;
+    }
+    if($status == 1) {
+        $pub = "SELECTED"; 
+        $unpub = ""; 
+    }elseif ($status == 0) {
+        $pub = ""; 
+        $unpub = "SELECTED";
     }
+}else{
+    $title = "";
+    $content = "";
+    $date = "";
+    $status = "";
+    $cat = "";
+    $pub = "";
+    $unpub = "";
+}
 ?>
-
+


-         New Post
+          Post
             


@@ -141,5 +144,6 @@
         
     

+

 
diff --git a/gxadmin/inc/settings.php b/gxadmin/inc/settings.php
index 1310439a..2d5362fe 100644
--- a/gxadmin/inc/settings.php
+++ b/gxadmin/inc/settings.php
@@ -12,7 +12,38 @@
 * @copyright 2014-2015 Puguh Wijayanto
 * @license http://www.opensource.org/licenses/mit-license.php MIT
 *
-*/?>
+*/
+
+if (isset($data['alertgreen'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    
+    ";
+    foreach ($data['alertgreen'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}
+
+if (isset($data['alertred'])) {
+    # code...
+    echo "
+    
+        ×
+        Close
+    ";
+    foreach ($data['alertred'] as $alert) {
+        # code...
+        echo "$alert\n";
+    }
+    echo "";
+}
+
+?>
 


@@ -50,7 +81,7 @@
                   

Website Name
-                          
+                          
Your Website Name, Title


@@ -66,12 +97,12 @@
                   

Website Domain
-                          
+                          
Your Domain, eg: example.org


Website URL
-                          
+                          
Your Website URL, eg: http://www.example.org


@@ -82,12 +113,12 @@
                   

Website Keywords
-                          
+                          
Your Website Keywords, type your website main keywords.


Website Description
-                          
+                          
Your Website Description, describe your website.


@@ -224,7 +255,7 @@
                               if($is_logourl == 'on' && $logourl != ''){
                                 $logoimg = "";
                               }elseif($is_logourl == 'off' && $logo != ''){
-                                $logoimg = "";
+                                $logoimg = "";
                               }else{
                                 $logoimg = '';
                               }
@@ -562,6 +593,7 @@ class="form-control disable" placeholder="Bootstrap Validator Version"
 
     

+


-            \t";
+            \t
+            \t";
         }
 
         $fa = Options::get('use_fontawesome');
@@ -111,11 +121,11 @@ public static function footer(){
             \t
             \t
 
-            \t
-            \t
-            \t
-            \t
-            \t
+            \t
+            \t
+            \t
+            \t
+            \t
             \t
+            \t
+            \t
             ";
 
             $foot .= $GLOBALS['validator_js'];
@@ -182,9 +192,9 @@ public static function footer(){
 
     public static function desc($vars){
         if(!empty($vars)){
-            $desc = substr(strip_tags(htmlspecialchars_decode($vars).". ".Options::get('sitedesc')),0,150);
+            $desc = substr(strip_tags(htmlspecialchars_decode($vars).". ".self::$desc),0,150);
         }else{
-            $desc = substr(Options::get('sitedesc'),0,150);
+            $desc = substr(self::$desc,0,150);
         }
         
         return $desc;
@@ -193,10 +203,10 @@ public static function desc($vars){
     public static function logo ($width='', $height='') {
         // check which logo is used, logourl or uploaded files.
         if( Options::get('is_logourl') == "on" && Options::get('logourl') != "" ) {
-            $logo = "";
         }elseif( Options::get('is_logourl') == "off" && Options::get('logo') != "" ){
-            $logo = "";
         }else{
             $logo = "";
diff --git a/inc/lib/System.class.php b/inc/lib/System.class.php
index 135ccd9d..a853c205 100644
--- a/inc/lib/System.class.php
+++ b/inc/lib/System.class.php
@@ -17,21 +17,42 @@
 
 class System
 {
-
+    /** 
+    * GeniXCMS Version Variable 
+    * @return double
+    */
     static $version          = "0.0.1";
+
+    /** 
+    * GeniXCMS Version Release 
+    * @return string
+    */
     static $v_release        = "";
 
+    /**
+    * System Constructor.
+    * Initializing the system, check the config file, if exist run the config
+    * loader. 
+    * @author Puguh Wijayanto (www.metalgenix.com)
+    * @since 0.0.1
+    */
     public function __construct () {
         if (self::existConf()) {
             # code...
             self::config('config');
-            self::lang(GX_LANG);
+            self::lang(GX_LANG);            
         }else{
             GxMain::install();
         }
         
     }
 
+    /**
+    * System Library Loader.
+    * This will include library which is called.
+    * @author Puguh Wijayanto (www.metalgenix.com)
+    * @since 0.0.1
+    */
     public static function lib($var) {
         include(GX_LIB.$var.'.class.php');
     }
@@ -109,4 +130,4 @@ public static function v () {
 }
 
 /* End of file system.class.php */
-/* Location: ./inc/lib/system.class.php */
\ No newline at end of file
+/* Location: ./inc/lib/system.class.php */
diff --git a/inc/lib/Token.class.php b/inc/lib/Token.class.php
new file mode 100644
index 00000000..ae155b78
--- /dev/null
+++ b/inc/lib/Token.class.php
@@ -0,0 +1,119 @@
+ array(
+                            'time' => TOKEN_TIME,
+                            'ip' => TOKEN_IP,
+                            'url' => TOKEN_URL
+                            )
+                    );
+        if(is_array($token)){
+            $newtoken = array_merge($token, $newtoken);
+        }
+
+        $newtoken = json_encode($newtoken);
+        return $newtoken;
+    }
+
+    public static function isExist($token){
+        $json = Options::get('tokens');
+        $tokens = json_decode($json, true);
+        if(array_key_exists($token, $tokens)){
+            $call = true;
+        }else{
+            $call = false;
+        }
+        return $call;
+    }
+
+    public static function remove($token){
+        $json = Options::get('tokens');
+        $tokens = json_decode($json, true);
+        unset($tokens[$token]);
+        $tokens = json_encode($tokens);
+        if(Options::update('tokens',$tokens)){
+            return true;
+        }else{
+            return false;
+        }
+    }
+
+    public static function ridOld() {
+        $json = Options::get('tokens');
+        $tokens = json_decode($json, true);
+        $time = time();
+        foreach ($tokens as $token => $value) {
+            # code...
+            //print_r($token);
+            if ($time - $value['time'] > 600) {
+                # code...
+                unset($tokens[$token]);
+            }
+        }
+        $tokens = json_encode($tokens);
+        if(Options::update('tokens',$tokens)){
+            return true;
+        }else{
+            return false;
+        }
+    }
+}
\ No newline at end of file
diff --git a/inc/lib/Upload.class.php b/inc/lib/Upload.class.php
index aa6c7c4c..cfa5ba3d 100644
--- a/inc/lib/Upload.class.php
+++ b/inc/lib/Upload.class.php
@@ -69,7 +69,7 @@ public static function go($input, $path, $allowed='', $uniq=false, $size='', $wi
                     $result['filename'] = $uniqfile.$filename;
                     $result['path'] = $path.$uniqfile.$filename;
                     $result['filepath'] = $filepath;
-                    $result['fileurl'] = Options::get('siteurl').$path.$uniqfile.$filename;
+                    $result['fileurl'] = Site::$url.$path.$uniqfile.$filename;
 
                 }else{
                     $result['error'] = 'Cannot upload to directory, please check 
diff --git a/inc/lib/Url.class.php b/inc/lib/Url.class.php
index 386e3101..688d1e3b 100644
--- a/inc/lib/Url.class.php
+++ b/inc/lib/Url.class.php
@@ -41,12 +41,12 @@ public static function post($vars) {
         switch (SMART_URL) {
             case true:
                 # code...
-                $url = Options::get('siteurl')."/".self::slug($vars)."/{$vars}";
+                $url = Site::$url."/".self::slug($vars)."/{$vars}";
                 break;
             
             default:
                 # code...
-                $url = Options::get('siteurl')."/index.php?post={$vars}";
+                $url = Site::$url."/index.php?post={$vars}";
                 break;
 
         }
@@ -66,12 +66,12 @@ public static function page($vars) {
         switch (SMART_URL) {
             case true:
                 # code...
-                $url = Options::get('siteurl')."/".self::slug($vars).GX_URL_PREFIX;
+                $url = Site::$url."/".self::slug($vars).GX_URL_PREFIX;
                 break;
             
             default:
                 # code...
-                $url = Options::get('siteurl')."/index.php?page={$vars}";
+                $url = Site::$url."/index.php?page={$vars}";
                 break;
 
         }
@@ -92,12 +92,12 @@ public static function cat($vars) {
         switch (SMART_URL) {
             case true:
                 # code...
-                $url = Options::get('siteurl')."/".$vars."/".Typo::slugify(Categories::name($vars));
+                $url = Site::$url."/".$vars."/".Typo::slugify(Categories::name($vars));
                 break;
             
             default:
                 # code...
-                $url = Options::get('siteurl')."/index.php?cat={$vars}";
+                $url = Site::$url."/index.php?cat={$vars}";
                 break;
 
         }
@@ -129,12 +129,12 @@ public static function sitemap() {
         switch (SMART_URL) {
             case true:
                 # code...
-                $url = Options::get('siteurl')."/sitemap".GX_URL_PREFIX;
+                $url = Site::$url."/sitemap".GX_URL_PREFIX;
                 break;
             
             default:
                 # code...
-                $url = Options::get('siteurl')."/index.php?page=sitemap";
+                $url = Site::$url."/index.php?page=sitemap";
                 break;
 
         }
@@ -154,12 +154,12 @@ public static function rss() {
         switch (SMART_URL) {
             case true:
                 # code...
-                $url = Options::get('siteurl')."/rss".GX_URL_PREFIX;
+                $url = Site::$url."/rss".GX_URL_PREFIX;
                 break;
             
             default:
                 # code...
-                $url = Options::get('siteurl')."/index.php?rss";
+                $url = Site::$url."/index.php?rss";
                 break;
 
         }
