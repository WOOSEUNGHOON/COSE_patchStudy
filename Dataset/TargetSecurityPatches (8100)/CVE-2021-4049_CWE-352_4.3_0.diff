e7fe1aa6a087d4d21b2e8a0dadd2e08f42acbb57
livehelperchat@@livehelperchat
diff --git a/lhc_web/design/defaulttheme/tpl/lhuser/wentinactive.tpl.php b/lhc_web/design/defaulttheme/tpl/lhuser/wentinactive.tpl.php
index dda6c94832..05530351c0 100644
--- a/lhc_web/design/defaulttheme/tpl/lhuser/wentinactive.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhuser/wentinactive.tpl.php
@@ -5,6 +5,6 @@
 
 getTranslation('user/wentinactive','Continue');?>
 
-getTranslation('user/wentinactive','Logout');?>
+getTranslation('user/wentinactive','Logout');?>

\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/pagelayouts/parts/user_box.tpl.php b/lhc_web/design/defaulttheme/tpl/pagelayouts/parts/user_box.tpl.php
index ed164cff65..9a908b9706 100644
--- a/lhc_web/design/defaulttheme/tpl/pagelayouts/parts/user_box.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/pagelayouts/parts/user_box.tpl.php
@@ -30,7 +30,7 @@
                 settings_brightnessgetTranslation('pagelayout/pagelayout','Dark/bright');?>


-                exit_to_appgetTranslation('pagelayout/pagelayout','Logout');?>
+                exit_to_appgetTranslation('pagelayout/pagelayout','Logout');?>


 
diff --git a/lhc_web/modules/lhuser/logout.php b/lhc_web/modules/lhuser/logout.php
index 1846b637cb..aab3351e66 100644
--- a/lhc_web/modules/lhuser/logout.php
+++ b/lhc_web/modules/lhuser/logout.php
@@ -4,13 +4,18 @@
 
 $lhUser = erLhcoreClassUser::instance();
 
+if (!$lhUser->isLogged() || !$lhUser->validateCSFRToken($Params['user_parameters_unordered']['csfr'])) {
+    die('Invalid CSFR Token');
+    exit;
+}
+
 erLhcoreClassChatEventDispatcher::getInstance()->dispatch('user.logout',array('user' => & $lhUser));
 
 $lhUser->logout();
 
 erLhcoreClassChatEventDispatcher::getInstance()->dispatch('user.after_logout',array('user' => & $lhUser));
 
-erLhcoreClassModule::redirect('user/login');
+//erLhcoreClassModule::redirect('user/login');
 exit;
 
 ?>
\ No newline at end of file
diff --git a/lhc_web/modules/lhuser/module.php b/lhc_web/modules/lhuser/module.php
index 31de060b1f..0fcacb1d89 100644
--- a/lhc_web/modules/lhuser/module.php
+++ b/lhc_web/modules/lhuser/module.php
@@ -20,7 +20,8 @@
 );
 
 $ViewList['logout'] = array(
-    'params' => array()
+    'params' => array(),
+    'uparams' => array('csfr')
 );
 
 $ViewList['loginas'] = array(
