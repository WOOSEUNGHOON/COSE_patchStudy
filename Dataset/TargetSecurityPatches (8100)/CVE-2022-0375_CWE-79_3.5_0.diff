bbfaa26ce54a2a86ce1a42a16496038f5bdfc102
livehelperchat@@livehelperchat
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/lists/msg_obj_list.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/lists/msg_obj_list.tpl.php
index 79292d18e0..e53c1f12e9 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/lists/msg_obj_list.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/lists/msg_obj_list.tpl.php
@@ -1,32 +1,29 @@
-user_id > -1 || $msg->user_id == -2) : 
+$messagesStats = array(
+    'total_messages' => count($messages),
+    'counter_messages' => 0,
+);
 
-if ($lastOperatorId !== false && $lastOperatorId != $msg->user_id) {
-    $lastOperatorChanged = true;
-} else {
-    $lastOperatorChanged = false;
-}
+foreach ($messages as $msg) :
+    $msg = $msg->getState();
+    $messagesStats['counter_messages']++;
 
-$lastOperatorId = $msg->user_id;
+    if ($lastOperatorId !== false && ($lastOperatorId != $msg['user_id'] || $msg['name_support'] != $lastOperatorNick)) {
+        $lastOperatorChanged = true;
+        $lastOperatorNick = $msg['name_support'];
+    } else {
+        $lastOperatorChanged = false;
+    }
 
-if ($msg->meta_msg != '') {
-    $metaMessageData = json_decode($msg->meta_msg, true); $messageId = $msg->id;
-} else if (isset($metaMessageData)) {
-    unset($metaMessageData);
-}
+    $lastOperatorId = $msg['user_id'];
+    $lastOperatorNick = $msg['name_support'];
 
-?>
-time);?>user_id == 0 ? htmlspecialchars($chat->nick) : htmlspecialchars($msg->name_support) ?>:Â 
 
-    msg; $paramsMessageRender = array('sender' => $msg->user_id);?>
-    
+    ?>
+    
+
 
-    
-        
-    
-
-
\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/lists/msg_obj_list_admin.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/lists/msg_obj_list_admin.tpl.php
index 768c33cd73..2e9f69ca2c 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/lists/msg_obj_list_admin.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/lists/msg_obj_list_admin.tpl.php
@@ -1,45 +1,8 @@
-user_id || $lastOperatorNick != $msg->name_support)) {
-    $lastOperatorChanged = true;
-    $lastOperatorNick = $msg->name_support;
-} else {
-    $lastOperatorChanged = false;
+getState();
 }
-
-$lastOperatorId = $msg->user_id;
-
-    if ($msg->meta_msg != '') {
-        $metaMessageData = json_decode($msg->meta_msg, true); $messageId = $msg->id;
-    } else if (isset($metaMessageData)) {
-        unset($metaMessageData);
-    }
-
+$messages = $messagesDefault;
 ?>
-user_id == -1) : ?>
-	time);?>getTranslation('chat/syncadmin','System assistant')?>msg))?>
-
-    msg != '' ||
-        isset($metaMessageData['content']['text_conditional']) ||
-        isset($metaMessageData['content']['chat_operation']) ||
-        isset($metaMessageData['content']['html']['content']) ||
-        isset($metaMessageData['content']['button_message'])
-    ) : ?>
-        time);?>user_id == 0) : ?>device_type == 0 ? 'computer' : ($chat->device_type == 1 ? 'smartphone' : 'tablet'))?>user_id == 0 ? htmlspecialchars($chat->nick) : htmlspecialchars($msg->name_support) ?>
-            msg; $paramsMessageRender = array('sender' => $msg->user_id, 'html_as_text' => true);?>
-            
-
-            
-                
-            
-            
-        
-    
-
-
\ No newline at end of file
+
\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhchat/messagelist/plain.tpl.php b/lhc_web/design/defaulttheme/tpl/lhchat/messagelist/plain.tpl.php
index c76443dab6..aa68a1ef75 100644
--- a/lhc_web/design/defaulttheme/tpl/lhchat/messagelist/plain.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhchat/messagelist/plain.tpl.php
@@ -1 +1,13 @@
-[time);?>] [user_id == 0 ? htmlspecialchars($chat->nick) : htmlspecialchars($msg->name_support) ?>] msg, array('sender' => $msg->user_id)),"\n"?>
\ No newline at end of file
+meta_msg) && $msg->meta_msg != '') {
+        $metaMessageData = json_decode($msg->meta_msg, true); $messageId = isset($triggerMessageId) ? $triggerMessageId : $msg->id;
+    } else if (isset($metaMessageData)) {
+        unset($metaMessageData);
+    }
+
+    if (isset($metaMessageData['content']['whisper']) || empty($msg->msg)) {
+        continue;
+    }
+
+    ?>[time);?>] [user_id == 0 ? htmlspecialchars($chat->nick) : htmlspecialchars($msg->name_support) ?>] msg, array('sender' => $msg->user_id)),"\n"?>
\ No newline at end of file
diff --git a/lhc_web/design/defaulttheme/tpl/lhform/collected.tpl.php b/lhc_web/design/defaulttheme/tpl/lhform/collected.tpl.php
index cbfa52e724..b91a8d6fb0 100644
--- a/lhc_web/design/defaulttheme/tpl/lhform/collected.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhform/collected.tpl.php
@@ -1,4 +1,4 @@
-

+

getTranslation('form/collected','Download XLS');?>

@@ -12,7 +12,7 @@
 	


 

-

+


getTranslation('form/collected','Name');?>

diff --git a/lhc_web/design/defaulttheme/tpl/lhtheme/admincss.tpl.php b/lhc_web/design/defaulttheme/tpl/lhtheme/admincss.tpl.php
index 59acb5c3e5..9ee2084de7 100644
--- a/lhc_web/design/defaulttheme/tpl/lhtheme/admincss.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhtheme/admincss.tpl.php
@@ -182,7 +182,7 @@
 

-    div.message-admin div.msg-body{
+    div.message-admin:not(.whisper-msg) div.msg-body{
         background-color: #;
color: #;
     }
diff --git a/lhc_web/design/defaulttheme/tpl/lhtheme/adminthemeedit.tpl.php b/lhc_web/design/defaulttheme/tpl/lhtheme/adminthemeedit.tpl.php
index 4461178dac..9c1db8f904 100644
--- a/lhc_web/design/defaulttheme/tpl/lhtheme/adminthemeedit.tpl.php
+++ b/lhc_web/design/defaulttheme/tpl/lhtheme/adminthemeedit.tpl.php
@@ -1,8 +1,5 @@
-
+
getTranslation('admintheme/form','Edit theme');?> - name)?>
-    
-        file_download
-    */ ?>
 

