ef5a66df4bcfacc7573322af33ce10c30e0bb896
thorsten@@phpMyFAQ
diff --git a/phpmyfaq/admin/ajax.attachment.php b/phpmyfaq/admin/ajax.attachment.php
index 304eaca8dd..a7ca90cdde 100644
--- a/phpmyfaq/admin/ajax.attachment.php
+++ b/phpmyfaq/admin/ajax.attachment.php
@@ -10,11 +10,9 @@
  * obtain one at http://mozilla.org/MPL/2.0/.
  *
  * @category  phpMyFAQ
- *
  * @author    Anatoliy Belsky 
  * @copyright 2010-2017 phpMyFAQ Team
  * @license   http://www.mozilla.org/MPL/2.0/ Mozilla Public License Version 2.0
- *
  * @link      http://www.phpmyfaq.de
  * @since     2010-12-20
  */
@@ -29,16 +27,23 @@
 
 $ajaxAction = PMF_Filter::filterInput(INPUT_GET, 'ajaxaction', FILTER_SANITIZE_STRING);
 $attId = PMF_Filter::filterInput(INPUT_GET, 'attId', FILTER_VALIDATE_INT);
+$csrfToken = PMF_Filter::filterInput(INPUT_GET, 'csrf', FILTER_SANITIZE_STRING);
 
 $att = PMF_Attachment_Factory::create($attId);
 
 if ($att) {
     switch ($ajaxAction) {
         case 'delete':
+
+            if (!isset($_SESSION['phpmyfaq_csrf_token']) || $_SESSION['phpmyfaq_csrf_token'] !== $csrfToken) {
+                echo $PMF_LANG['err_NotAuth'];
+                exit(1);
+            }
+
             if ($att->delete()) {
-                print $PMF_LANG['msgAttachmentsDeleted'];
+                echo $PMF_LANG['msgAttachmentsDeleted'];
             } else {
-                print $PMF_LANG['ad_att_delfail'];
+                echo $PMF_LANG['ad_att_delfail'];
             }
             break;
     }
diff --git a/phpmyfaq/admin/att.main.php b/phpmyfaq/admin/att.main.php
index 238c17848c..c83cf7df9b 100644
--- a/phpmyfaq/admin/att.main.php
+++ b/phpmyfaq/admin/att.main.php
@@ -70,7 +70,7 @@
                             filesize ?>
mime_type ?>

-                                


@@ -92,15 +92,16 @@ class="btn btn-danger" title="">
          * Ajax call for deleting attachments
          *
          * @param att_id Attachment id
+         * @apram csrf CSRF token
          */
-        function deleteAttachment(att_id)
+        function deleteAttachment(att_id, csrf)
         {
             if (confirm('')) {
                 $('#saving_data_indicator').html(' Deleting ...');
                 $.ajax({
                     type:    "GET",
                     url:     "index.php?action=ajax&ajax=att&ajaxaction=delete",
-                    data:    {attId: att_id},
+                    data:    { attId: att_id, csrf: csrf},
                     success: function(msg) {
                         $('.att_' + att_id).fadeOut('slow');
                         $('#saving_data_indicator').html('' + msg + '');
