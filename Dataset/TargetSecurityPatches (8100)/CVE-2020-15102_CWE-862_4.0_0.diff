f0799c13628a9b9ca6ca75c085b083d924a8ea7e
PrestaShop@@dashproducts
diff --git a/dashproducts.php b/dashproducts.php
index e08c6d3..36dd426 100755
--- a/dashproducts.php
+++ b/dashproducts.php
@@ -72,7 +72,7 @@ public function hookDashboardZoneTwo($params)
                 'DASHPRODUCT_NBR_SHOW_TOP_SEARCH' => Configuration::get('DASHPRODUCT_NBR_SHOW_TOP_SEARCH'),
                 'date_from' => Tools::displayDate($params['date_from']),
                 'date_to' => Tools::displayDate($params['date_to']),
-                'dashproducts_config_form' => $this->renderConfigForm(),
+                'dashproducts_config_form' => $this->getPermission('configure') ? $this->renderConfigForm() : null,
             )
         );
 
@@ -617,4 +617,44 @@ public function hookActionSearch($params)
     {
         Tools::changeFileMTime($this->push_filename);
     }
+
+    /**
+     * Validate dashboard configuration
+     *
+     * @param array $config
+     *
+     * @return array
+     */
+    public function validateDashConfig(array $config)
+    {
+        $errors = [];
+        $possibleValues = [5, 10, 20, 50];
+        foreach (array_keys($this->getConfigFieldsValues()) as $fieldName) {
+            if (!isset($config[$fieldName]) || !in_array($config[$fieldName], $possibleValues)) {
+                $errors[$fieldName] = $this->trans('The %s field is invalid.', [$fieldName], 'Modules.Dashproducts.Admin');
+            }
+        }
+
+        return $errors;
+    }
+
+    /**
+     * Save dashboard configuration
+     *
+     * @param array $config
+     *
+     * @return bool determines if there are errors or not
+     */
+    public function saveDashConfig(array $config)
+    {
+        if (!$this->getPermission('configure')) {
+            return true;
+        }
+
+        foreach (array_keys($this->getConfigFieldsValues()) as $fieldName) {
+            Configuration::updateValue($fieldName, (int) $config[$fieldName]);
+        }
+
+        return false;
+    }
 }
diff --git a/views/templates/hook/dashboard_zone_two.tpl b/views/templates/hook/dashboard_zone_two.tpl
index 084c6af..1a497ca 100644
--- a/views/templates/hook/dashboard_zone_two.tpl
+++ b/views/templates/hook/dashboard_zone_two.tpl
@@ -1,123 +1,127 @@
 {*
-* 2007-2018 PrestaShop
-*
-* NOTICE OF LICENSE
-*
-* This source file is subject to the Academic Free License (AFL 3.0)
-* that is bundled with this package in the file LICENSE.txt.
-* It is also available through the world-wide-web at this URL:
-* http://opensource.org/licenses/afl-3.0.php
-* If you did not receive a copy of the license and are unable to
-* obtain it through the world-wide-web, please send an email
-* to license@prestashop.com so we can send you a copy immediately.
-*
-* DISCLAIMER
-*
-* Do not edit or add to this file if you wish to upgrade PrestaShop to newer
-* versions in the future. If you wish to customize PrestaShop for your
-* needs please refer to http://www.prestashop.com for more information.
-*
-*  @author PrestaShop SA 
-*  @copyright  2007-2018 PrestaShop SA
-*  @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
-*  International Registered Trademark & Property of PrestaShop SA
-*}
+  * 2007-2018 PrestaShop
+  *
+  * NOTICE OF LICENSE
+  *
+  * This source file is subject to the Academic Free License (AFL 3.0)
+  * that is bundled with this package in the file LICENSE.txt.
+  * It is also available through the world-wide-web at this URL:
+  * http://opensource.org/licenses/afl-3.0.php
+  * If you did not receive a copy of the license and are unable to
+  * obtain it through the world-wide-web, please send an email
+  * to license@prestashop.com so we can send you a copy immediately.
+  *
+  * DISCLAIMER
+  *
+  * Do not edit or add to this file if you wish to upgrade PrestaShop to newer
+  * versions in the future. If you wish to customize PrestaShop for your
+  * needs please refer to http://www.prestashop.com for more information.
+  *
+  *  @author PrestaShop SA 
+  *  @copyright  2007-2018 PrestaShop SA
+  *  @license    http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
+  *  International Registered Trademark & Property of PrestaShop SA
+  *}
 
 
-	
-		 {l s='Products and Sales' d='Modules.Dashproducts.Admin'}
-		
-			
-				
-			
-			
-				
-			
-		
-	
+  
+     {l s='Products and Sales' d='Modules.Dashproducts.Admin'}
+    
+      {if !empty($dashproducts_config_form)}
+        
+          
+        
+      {/if}
+      
+        
+      
+    
+  
 
-	
-		 {l s='Configuration' d='Admin.Global'}
-		{$dashproducts_config_form}
-	
+  {if !empty($dashproducts_config_form)}
+    
+       {l s='Configuration' d='Admin.Global'}
+      {$dashproducts_config_form}
+    
+  {/if}
 
-	
-		
-			
-				
-					
-						
-						{l s='Recent Orders' d='Modules.Dashproducts.Admin'}
-					
-				
-				
-					
-						
-						{l s='Best Sellers' d='Modules.Dashproducts.Admin'}
-					
-				
-				
-					
-						
-						{l s='Most Viewed' d='Modules.Dashproducts.Admin'}
-					
-				
-				
-					
-						
-						{l s='Top Searches' d='Modules.Dashproducts.Admin'}
-					
-				
-			
-		
+  
+    
+      
+        
+          
+            
+            {l s='Recent Orders' d='Modules.Dashproducts.Admin'}
+          
+        
+        
+          
+            
+            {l s='Best Sellers' d='Modules.Dashproducts.Admin'}
+          
+        
+        
+          
+            
+            {l s='Most Viewed' d='Modules.Dashproducts.Admin'}
+          
+        
+        
+          
+            
+            {l s='Top Searches' d='Modules.Dashproducts.Admin'}
+          
+        
+      
+    
 
-		
-			
-				{l s='Last %d orders' sprintf=$DASHPRODUCT_NBR_SHOW_LAST_ORDER|intval d='Modules.Dashproducts.Admin'}
-				
-					
-						
-						
-					
-				
-			
-			
-				
-					{l s='Top %d products' sprintf=$DASHPRODUCT_NBR_SHOW_BEST_SELLER|intval d='Modules.Dashproducts.Admin'}
-					{l s="From" d='Modules.Dashproducts.Admin'} {$date_from|escape:'htmlall':'UTF-8'} {l s="to" d='Modules.Dashproducts.Admin'} {$date_to|escape:'htmlall':'UTF-8'}
-				
-				
-					
-						
-						
-					
-				
-			
-			
-				
-					{l s="Most Viewed" d='Modules.Dashproducts.Admin'}
-					{l s="From" d='Modules.Dashproducts.Admin'} {$date_from|escape:'htmlall':'UTF-8'} {l s="to" d='Modules.Dashproducts.Admin'} {$date_to|escape:'htmlall':'UTF-8'}
-				
-				
-					
-						
-						
-					
-				
-			
-			
-				
-					{l s='Top %d most search terms' sprintf=$DASHPRODUCT_NBR_SHOW_TOP_SEARCH|intval d='Modules.Dashproducts.Admin'}
-					{l s="From" d='Modules.Dashproducts.Admin'} {$date_from|escape:'htmlall':'UTF-8'} {l s="to" d='Modules.Dashproducts.Admin'} {$date_to|escape:'htmlall':'UTF-8'}
-				
-				
-					
-						
-						
-					
-				
-			
-		
+    
+      
+        {l s='Last %d orders' sprintf=$DASHPRODUCT_NBR_SHOW_LAST_ORDER|intval d='Modules.Dashproducts.Admin'}
+        
+          
+            
+            
+          
+        
+      
+      
+        
+          {l s='Top %d products' sprintf=$DASHPRODUCT_NBR_SHOW_BEST_SELLER|intval d='Modules.Dashproducts.Admin'}
+          {l s="From" d='Modules.Dashproducts.Admin'} {$date_from|escape:'htmlall':'UTF-8'} {l s="to" d='Modules.Dashproducts.Admin'} {$date_to|escape:'htmlall':'UTF-8'}
+        
+        
+          
+            
+            
+          
+        
+      
+      
+        
+          {l s="Most Viewed" d='Modules.Dashproducts.Admin'}
+          {l s="From" d='Modules.Dashproducts.Admin'} {$date_from|escape:'htmlall':'UTF-8'} {l s="to" d='Modules.Dashproducts.Admin'} {$date_to|escape:'htmlall':'UTF-8'}
+        
+        
+          
+            
+            
+          
+        
+      
+      
+        
+          {l s='Top %d most search terms' sprintf=$DASHPRODUCT_NBR_SHOW_TOP_SEARCH|intval d='Modules.Dashproducts.Admin'}
+          {l s="From" d='Modules.Dashproducts.Admin'} {$date_from|escape:'htmlall':'UTF-8'} {l s="to" d='Modules.Dashproducts.Admin'} {$date_to|escape:'htmlall':'UTF-8'}
+        
+        
+          
+            
+            
+          
+        
+      
+    
 
-	
+  

