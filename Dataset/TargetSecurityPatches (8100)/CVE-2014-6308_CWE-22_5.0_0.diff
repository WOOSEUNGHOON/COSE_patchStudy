c163bf5910d0d36424d7fc678da6b03a0e443435
osclass@@Osclass
diff --git a/oc-admin/appearance.php b/oc-admin/appearance.php
index 950cbd58e..bdec783d3 100755
--- a/oc-admin/appearance.php
+++ b/oc-admin/appearance.php
@@ -169,7 +169,34 @@ function doModel()
                     $this->redirectTo( osc_admin_base_url(true) . "?page=appearance" );
                 break;
                 case('render'):
-                    $this->_exportVariableToView('file', osc_base_path() . Params::getParam("file"));
+                    if(Params::existParam('route')) {
+                        $routes = Rewrite::newInstance()->getRoutes();
+                        $rid = Params::getParam('route');
+                        $file = '../';
+                        if(isset($routes[$rid]) && isset($routes[$rid]['file'])) {
+                            $file = $routes[$rid]['file'];
+                        }
+                    } else {
+                        // DEPRECATED: Disclosed path in URL is deprecated, use routes instead
+                        // This will be REMOVED in 3.6
+                        $file = Params::getParam('file');
+                        // We pass the GET variables (in case we have somes)
+                        if(preg_match('|(.+?)\?(.*)|', $file, $match)) {
+                            $file = $match[1];
+                            if(preg_match_all('|&([^=]+)=([^&]*)|', urldecode('&'.$match[2].'&'), $get_vars)) {
+                                for($var_k=0;$var_k_exportVariableToView('file', osc_base_path() . $file);
                     $this->doView('appearance/view.php');
                 break;
                 default:
diff --git a/oc-admin/themes/modern/appearance/view.php b/oc-admin/themes/modern/appearance/view.php
index d9b2519bf..929805a24 100644
--- a/oc-admin/themes/modern/appearance/view.php
+++ b/oc-admin/themes/modern/appearance/view.php
@@ -14,7 +14,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-
+    $file = __get('file');
     osc_add_hook('admin_page_header','customPageHeader');
     function customPageHeader() { ?>
         
@@ -30,8 +30,8 @@ function customPageTitle($string) {
 



diff --git a/oc-admin/themes/modern/plugins/view.php b/oc-admin/themes/modern/plugins/view.php
index 628299e6a..fd722e2cc 100644
--- a/oc-admin/themes/modern/plugins/view.php
+++ b/oc-admin/themes/modern/plugins/view.php
@@ -14,7 +14,7 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-
+    $file = __get('file');
     osc_add_hook('admin_page_header','customPageHeader');
     function customPageHeader() { ?>
         
@@ -30,8 +30,8 @@ function customPageTitle($string) {
 



diff --git a/oc-includes/osclass/classes/datatables/ItemsDataTable.php b/oc-includes/osclass/classes/datatables/ItemsDataTable.php
index 8b162ced6..12005e0f6 100644
--- a/oc-includes/osclass/classes/datatables/ItemsDataTable.php
+++ b/oc-includes/osclass/classes/datatables/ItemsDataTable.php
@@ -138,8 +138,8 @@ private function addTableHeader()
             $this->addColumn('user', __('User'));
             $this->addColumn('category', __('Category'));
             $this->addColumn('location', __('Location'));
-            $this->addColumn('date', ''.__('Date').'');
-            $this->addColumn('expiration', ''.__('Expiration date').'');
+            $this->addColumn('date', ''.__('Date').'');
+            $this->addColumn('expiration', ''.__('Expiration date').'');
 
             $dummy = &$this;
             osc_run_hook("admin_items_table", $dummy);
@@ -197,13 +197,13 @@ private function addTableHeaderReported()
             $this->addColumn('bulkactions', '');
             $this->addColumn('title', __('Title'));
             $this->addColumn('user', __('User'));
-            $this->addColumn('spam', ''.__('Spam').'');
-            $this->addColumn('bad', ''.__('Misclassified').'');
-            $this->addColumn('rep', ''.__('Duplicated').'');
-            $this->addColumn('exp', ''.__('Expired').'');
-            $this->addColumn('off', ''.__('Offensive').'');
-            $this->addColumn('date', ''.__('Date').'');
-            $this->addColumn('expiration', ''.__('Expiration date').'');
+            $this->addColumn('spam', ''.__('Spam').'');
+            $this->addColumn('bad', ''.__('Misclassified').'');
+            $this->addColumn('rep', ''.__('Duplicated').'');
+            $this->addColumn('exp', ''.__('Expired').'');
+            $this->addColumn('off', ''.__('Offensive').'');
+            $this->addColumn('date', ''.__('Date').'');
+            $this->addColumn('expiration', ''.__('Expiration date').'');
 
             $dummy = &$this;
             osc_run_hook("admin_items_reported_table", $dummy);
diff --git a/oc-includes/osclass/classes/datatables/MediaDataTable.php b/oc-includes/osclass/classes/datatables/MediaDataTable.php
index 2659d2421..9edf509bd 100644
--- a/oc-includes/osclass/classes/datatables/MediaDataTable.php
+++ b/oc-includes/osclass/classes/datatables/MediaDataTable.php
@@ -73,8 +73,8 @@ private function addTableHeader()
             $this->addColumn('bulkactions', '');
             $this->addColumn('file', __('File'));
             $this->addColumn('action', __('Action'));
-            $this->addColumn('attached_to', ''.__('Attached to').'');
-            $this->addColumn('date', ''.__('Date').'');
+            $this->addColumn('attached_to', ''.__('Attached to').'');
+            $this->addColumn('date', ''.__('Date').'');
 
             $dummy = &$this;
             osc_run_hook("admin_media_table", $dummy);
